/*! dhx 2015-06-01 */
$dhx.dataDriver={version:"1.0.3",dbs:{},_table_to_fill_on_init:0,_table_to_filled_on_init:0,_total_fkeys_to_check:[],_total_fkeys_checked:[],_total_records_to_check:[],_total_records_checked:[],browserPassed:function(){"use strict";return"Chrome"==$dhx.Browser.name?$dhx.Browser.version<31?(console.log("Browser is out to date"),$dhx.showDirections("BROWSER_VERSION_OUT_TO_DATE"),!1):(console.log("Browser is OK for $dhx.dataDriver"),!0):"Firefox"==$dhx.Browser.name?$dhx.Browser.version<31?(console.log("Browser is out to date"),$dhx.showDirections("BROWSER_VERSION_OUT_TO_DATE"),!1):(console.log("Browser is OK for $dhx.dataDriver"),!0):"Opera"==$dhx.Browser.name?$dhx.Browser.version<27?(console.log("Browser is out to date"),$dhx.showDirections("BROWSER_VERSION_OUT_TO_DATE"),!1):(console.log("Browser is OK for $dhx.dataDriver"),!0):"Safari"==$dhx.Browser.name?$dhx.Browser.version<7?(console.log("Browser is out to date"),$dhx.showDirections("BROWSER_VERSION_OUT_TO_DATE"),!1):(console.log("Browser is OK for $dhx.dataDriver"),!0):"Explorer"==$dhx.Browser.name?(console.log("Browser vendor not allowed"),$dhx.showDirections("BROWSER_NOT_ALLOWED"),!1):(console.log("Browser vendor not allowed"),$dhx.showDirections("BROWSER_NOT_ALLOWED"),!1)},validDSN:function(a){"use strict";if("undefined"==typeof a.db||0===a.db.length)return dhtmlx.message({type:"error",text:"db is missing when creating a database"}),a.onFail&&a.onFail({message:"db is missing when creating a database"}),!1;if("undefined"==typeof a.schema)a.schema={};else if(!$dhx.isObject(a.schema))return dhtmlx.message({type:"error",text:"when you pass the parameter 'schema' to the constructor, it need to be an object"}),a.onFail&&a.onFail({message:"when you pass the parameter 'schema' to the constructor, it need to be an array"}),!1;return a},validTableConf:function(a){"use strict";$dhx.dataDriver;return"undefined"==typeof a.db||0===a.db.length?(dhtmlx.message({type:"error",text:"db is missing when creating a table"}),a.onFail&&a.onFail({message:"db is missing when creating a table"}),!1):"undefined"==typeof a.table||0===a.table.length?(dhtmlx.message({type:"error",text:"table is missing when creating a table"}),a.onFail&&a.onFail({message:"table is missing when creating a table"}),!1):"undefined"==typeof a.primary_key?(dhtmlx.message({type:"error",text:"primary_key is missing when creating a table"}),a.onFail&&a.onFail({message:"primary_key is missing when creating a table"}),!1):a},validIndexConf:function(a){"use strict";$dhx.dataDriver;return"undefined"==typeof a.unique&&(a.unique=!1),"undefined"==typeof a.type&&(a.type="character varying"),"undefined"==typeof a.maxlength&&(a.maxlength="-1"),"undefined"==typeof a["default"]&&(a["default"]=""),"undefined"==typeof a.format&&(a.format=""),"undefined"==typeof a.validation&&(a.validation=""),"undefined"==typeof a.required&&(a.required=!1),"serial"==a.type.toLowerCase()?{type:"serial",required:!0,validation:"integer",unique:!0}:a},validRecord:function(a,b){"use strict";var c=$dhx.dataDriver,d={};if(!$dhx.isObject(b))return"can not parse record"+b;for(var e in a.columns)if(a.columns.hasOwnProperty(e))if(b.hasOwnProperty(e)){if(1==a.columns[e].required&&("undefined"==typeof b[e]||""==b[e]||null==b[e]))return"column '"+e+"' is a required column";if("integer"==a.columns[e].type&&"NO"==a.columns[e].is_nullable&&b[e].toString().length>0&&!c._validateValueByType(b[e],"ValidInteger",e))return"column '"+e+"' just accepts integer values. Entered value: "+b[e];if("date"==a.columns[e].type&&"NO"==a.columns[e].is_nullable&&b[e].toString().length>0&&!c._validateValueByType(b[e],"ValidDate",e))return"column '"+e+"' just accepts date values. Entered value: "+b[e];if(a.columns[e].type.indexOf("timestamp")>-1&&"NO"==a.columns[e].is_nullable&&b[e].toString().length>0&&!c._validateValueByType(b[e],"ValidTime",e))return"column '"+e+"' just accepts date timestamp values. Entered value: "+b[e];if("numeric"==a.columns[e].type&&"NO"==a.columns[e].is_nullable&&b[e].toString().length>0&&!c._validateValueByType(b[e],"ValidNumeric",e))return"column '"+e+"' just accepts date numeric values. Entered value: "+b[e];d[e]=b[e]}else if(1==a.columns[e].required&&a.primary_key.keyPath!=e)return"column '"+e+"' is a required column";return d[a.primary_key.keyPath]=b[a.primary_key.keyPath],d},validRecordUpdate:function(a,b){"use strict";var c=($dhx.dataDriver,{});if($dhx.isObject(b))for(var d in b){if(!b.hasOwnProperty(d))return"can not parse record"+b;if("undefined"==typeof a.columns[d]&&a.primary_key.keyPath!=d)return"column "+d+" does not exist";"serial"!=a.columns[d].type.toLowerCase()&&(c[d]=b[d])}return c},createTable:function(a){"use strict";try{if(!$dhx.dataDriver.validTableConf(a))return;var b=a.db,c=$dhx.dataDriver,d=null;if(d=$dhx.isObject(a.primary_key)?c.dbs[b].db.createObjectStore(a.table,a.primary_key):c.dbs[b].db.createObjectStore(a.table,{keyPath:a.primary_key,autoIncrement:!0}),$dhx.isObject(a.columns))for(var e in a.columns)if(a.columns.hasOwnProperty(e)){if(0==$dhx.dataDriver.validIndexConf(a.columns[e]))continue;a.columns[e].index&&(1==a.columns[e].unique?"":a.columns[e].unique=!1,d.createIndex(e,e,{unique:a.columns[e].unique}))}d.transaction.addEventListener("complete",function(d){var e="table "+a.table+" created successfully";$dhx._enable_log&&console.warn(e),c.dbs[b].onCreate&&c.dbs[b].onCreate({connection:c.dbs[b].connection.connection,event:c.dbs[b].connection.event,message:e})})}catch(f){$dhx._enable_log&&console.warn("sorry Eduardo, I cant create table ! Error message: "+f.message),a.onFail&&a.onFail(null,null,f.message)}},dropDatabase:function(a){"use strict";var b=$dhx.dataDriver;try{b.disconnect(a.db);var c=b.indexedDB.deleteDatabase(a.db);c.onsuccess=function(b){$dhx.jDBdStorage.storeObject("$dhx.db."+a.db,JSON.stringify({})),$dhx._enable_log&&console.warn("Deleted database "+a.db+" successfully"),a.onSuccess&&a.onSuccess("Deleted database "+a.db+" successfully",c,b)},c.onerror=function(b){a.onFail&&a.onFail(c,b,b.target.error.message)},c.onblocked=function(b){throw"Couldn't delete database "+a.db+" due to the operation being blocked"}}catch(d){$dhx._enable_log&&console.warn("sorry Eduardo, I cant drop database ! Error message: "+d.message),a.onFail&&a.onFail(null,null,d.message)}},getTableSizeInBytes:function(a){"use strict";try{var b=$dhx.dataDriver,c=a.db,d=(b.dbs[c].schema[a.table],0);console.time("get db size operation "+$dhx.crypt.SHA2(JSON.stringify(a)));var e=b.db(c).transaction(a.table,"readonly"),f=e.objectStore(a.table),g=f.openCursor();a.onSuccess=a.onSuccess||!1,a.onFail=a.onFail||!1;var h="";e.addEventListener("complete",function(a){$dhx._enable_log&&console.warn("tx getTableSizeInBytes is complete done")}),e.addEventListener("onerror",function(a){$dhx._enable_log&&console.log("error on transaction")}),e.addEventListener("abort",function(a){$dhx._enable_log&&console.warn("transaction aborted")}),g.addEventListener("success",function(b){var c=b.target.result;if(c){var d=JSON.stringify(c.value);h+=d,c["continue"]()}else{$dhx._enable_log&&console.warn("executed"),$dhx._enable_log&&console.log("transaction complete - DB size computed      ",b),console.timeEnd("get db size operation "+$dhx.crypt.SHA2(JSON.stringify(a))),h=$dhx.UTF8.decode(h);var f=new Blob([h],{type:"text/html"});a.onSuccess&&a.onSuccess(e,b,f.size)}}),g.addEventListener("error",function(b){$dhx._enable_log&&console.warn("sorry Eduardo, couldnt fecth data! Error message: "+b),console.timeEnd("get db size operation "+$dhx.crypt.SHA2(JSON.stringify(a))),a.onFail&&a.onFail(g,b,d)})}catch(i){$dhx._enable_log&&console.warn("sorry Eduardo, I cant get table size ! Error message: "+i.message),a.onFail&&a.onFail(null,null,i.message)}},_completeAdd:function(a,b,c,d,e,f,g,h,i,j,k){var b=$dhx.dataDriver;k=k||!1,console.timeEnd(f),$dhx._enable_log&&console.warn("executed _completeAdd operation at: "+a.table),$dhx._enable_log&&console.log("transaction complete      ",c),$dhx._enable_log&&console.warn("rows affected: "+e),$dhx.MQ.publish(b.dbs[g].root_topic+"."+h,{action:"add",target:"table",name:h,status:"success",message:"record added",records:j,onInit:k}),$dhx.dataDriver["public"][a.table].onAfterAdd(j,e),a.onSuccess&&a.onSuccess(d,c,e),j=null},_addSaveOnTable:function(a,b,c){function d(b){var c=e.getTableSchema(a),d=c.primary_key.keyPath;"undefined"==typeof b[d]&&(b[d]=(new Date).getTime()),""==b[d]&&(b[d]=(new Date).getTime()),0==b[d]&&(b[d]=(new Date).getTime()),l.add(b),m.push(b)}try{var e=$dhx.dataDriver,f=a.db,g=e.dbs[f].schema[a.table],h=0,i=a.isOnCreate;$dhx.dataDriver["public"][a.table].onBeforeAdd();var j="_addSaveOnTable operation at "+a.table+" "+$dhx.crypt.SHA2(JSON.stringify(a));console.time(j);var k=e.db(f).transaction(a.table,"readwrite"),l=k.objectStore(a.table),m=[];if(a.onSuccess=a.onSuccess||!1,a.onFail=a.onFail||!1,k.oncomplete=function(b){e._completeAdd(a,e,b,k,h,j,f,a.table,l,m,i)},k.onerror=function(b){$dhx._enable_log&&console.warn("error name: ",b.srcElement.error.name),$dhx._enable_log&&console.warn("sorry Eduardo, couldnt add record. error message: "+b.srcElement.error.message),$dhx._enable_log&&console.warn("rows affected: 0"),console.timeEnd(j),a.onFail&&a.onFail(k,b,h),m=null},k.onabort=function(a){$dhx._enable_log&&console.warn("   >>>>  ABORTED   <<<<  "),$dhx._enable_log&&console.log(a.target.error.name,a.target.error.message),console.timeEnd(j),m=null},$dhx.isObject(a.record)){$dhx._enable_log&&console.warn("........... trying to insert single record on "+a.table);var n=e.validRecord(g,a.record);if(!$dhx.isObject(n)){var o={};return o.target=o.target||{},o.target.error=o.target.error||{},o.target.error.name="Type constraint",o.target.error.message=n,a.onFail&&a.onFail(null,o,n),void($dhx._enable_log&&console.warn("sorry Eduardo, invalid record! Error message: "+n))}$dhx._enable_log&&console.log("preparing record ",n),h+=1,d(n)}else{if(!$dhx.isArray(a.record))return void($dhx._enable_log&&console.warn("sorry Eduardo, I cant parse the record payload"));if($dhx._enable_log&&console.warn("........... trying to insert "+a.record.length+" records on "+a.table),a.record.length>0)for(var p=0;p<a.record.length;p++){var q=a.record[p],n=e.validRecord(g,q);$dhx.isObject(n)?($dhx._enable_log&&console.log("preparing record ",n),h+=1,d(n)):($dhx._enable_log&&console.warn("record ignored: ",JSON.stringify(q)),$dhx._enable_log&&console.warn("sorry Eduardo, invalid record! Error message: "+n))}else $dhx._enable_log&&console.log("any record was passed to insert")}}catch(r){$dhx._enable_log&&console.warn("sorry Eduardo, I cant add record! Error message: "+r.message),a.onFail&&a.onFail(null,null,r.message)}},_checkFkey:function(a){try{var b=$dhx.dataDriver,c=a.db,d=(b.dbs[c].schema[a.table],b.getTableSchema(a)),e=d.primary_key.keyPath;found=!1;var f="check fkey. task: "+$dhx.crypt.SHA2(JSON.stringify(a));console.time(f);var g=b.db(c).transaction(a.table,"readonly"),h=g.objectStore(a.table);g.addEventListener("complete",function(a){console.timeEnd(f),$dhx._enable_log&&console.warn("executed"),$dhx._enable_log&&console.warn("tx _checkFkey is completed")}),g.addEventListener("onerror",function(b){console.timeEnd(f),dhtmlx.message({type:"error",text:b.target.error.message}),a.onFail&&a.onFail(g,b,b.target.error.message),$dhx._enable_log&&console.log("error on transaction")}),g.addEventListener("abort",function(b){console.timeEnd(f),dhtmlx.message({type:"error",text:b.target.error.message}),a.onFail&&a.onFail(g,b,b.target.error.message),$dhx._enable_log&&console.warn("transaction aborted")});var i=null,j="";a.column==e?j=h.get(parseInt(a.value)):(i=h.index(a.column),j=i.get(a.value)),j.onsuccess=function(b){var c=b.target.result;if(c)a.onSuccess&&a.onSuccess(!0,g,b);else{var d="value "+a.value+" not found on column '"+a.column+"' from table "+a.table;dhtmlx.message({type:"error",text:d});var e={};e.target=e.target||{},e.target.error=e.target.error||{},e.target.error.name="Foreign Key constraint",e.target.error.message=d,a.onFail&&a.onFail(g,e,d)}}}catch(k){$dhx._enable_log&&console.warn("sorry Eduardo, I cant _checkFkey! Error message: "+k.message),a.onFail&&a.onFail(null,null,k.message)}},_addCheckFkeys:function(a,b,c){try{var d=$dhx.dataDriver,e=a.db,f=d.dbs[e].schema[a.table];f.primary_key.keyPath;if(rows_affected=0,isOnCreate=a.isOnCreate,$dhx.isObject(a.record)){$dhx._enable_log&&console.warn("........... checking fkeys for one record "+a.table);var g=d.validRecord(f,a.record);if(!$dhx.isObject(g)){var h={};return h.target=h.target||{},h.target.error=h.target.error||{},h.target.error.name="Type constraint",h.target.error.message=g,a.onFail&&a.onFail(null,h,g),void($dhx._enable_log&&console.warn("sorry Eduardo, invalid record, I cant check it fkeys! Error message: "+g))}var i=$dhx.crypt.SHA2(JSON.stringify(g));d._total_fkeys_to_check[i]=Object.keys(f.foreign_keys).length,d._total_fkeys_checked[i]=0;for(var j in f.foreign_keys)f.foreign_keys.hasOwnProperty(j)&&d._checkFkey({db:a.db,table:f.foreign_keys[j].table,column:f.foreign_keys[j].column,value:g[f.foreign_keys[j].column],onSuccess:function(e,f,g){d._total_fkeys_checked[i]=d._total_fkeys_checked[i]+1,d._total_fkeys_checked[i]==d._total_fkeys_to_check[i]&&d._addSaveOnTable(a,b,c)},onFail:function(b,c,d){$dhx._enable_log&&console.warn("sorry Eduardo,  value "+g[f.foreign_keys[j].column]+' not found at the "'+f.foreign_keys[j].table+'" foreign table! Error message: ',d),a.onFail&&a.onFail(b,c,d)}})}else{if(!$dhx.isArray(a.record))return void($dhx._enable_log&&console.warn("sorry Eduardo, I cant parse the record payload"));if($dhx._enable_log&&console.warn("........... checking fkeys for "+a.record.length+" records on "+a.table),a.record.length>0){var k=$dhx.crypt.SHA2(JSON.stringify(a.record));d._total_records_to_check[k]=a.record.length,d._total_records_checked[k]=0;for(var l=0;l<a.record.length;l++){var m=a.record[l],g=d.validRecord(f,m);if(console.log(g),console.log(g),console.log(g),console.log(g),console.log(g),console.log(g),console.log(g),console.log(g),console.log(g),console.log(g),console.log(g),console.log(g),$dhx.isObject(g)){var i=$dhx.crypt.SHA2(JSON.stringify(g));d._total_fkeys_to_check[i]=Object.keys(f.foreign_keys).length,d._total_fkeys_checked[i]=0;for(var j in f.foreign_keys)f.foreign_keys.hasOwnProperty(j)&&d._checkFkey({db:a.db,table:f.foreign_keys[j].table,column:f.foreign_keys[j].column,value:g[f.foreign_keys[j].column],onSuccess:function(e,f,g){d._total_records_checked[k]=d._total_records_checked[k]+1,d._total_fkeys_checked[i]=d._total_fkeys_checked[i]+1,d._total_fkeys_to_check[i]==d._total_records_checked[k]&&d._total_fkeys_checked[i]==d._total_fkeys_to_check[i]&&d._addSaveOnTable(a,b,c)},onFail:function(b,c,d){$dhx._enable_log&&console.warn("sorry Eduardo,  value "+g[f.foreign_keys[j].column]+' not found at the "'+f.foreign_keys[j].table+'" foreign table! Error message: '+g),a.onFail&&a.onFail(b,c,d)}})}else $dhx._enable_log&&console.warn("record ignored: ",JSON.stringify(m)),$dhx._enable_log&&console.warn("sorry Eduardo, invalid record, I cant check it fkeys! Error message: "+g)}}else $dhx._enable_log&&console.log("any record was passed to insert")}}catch(n){$dhx._enable_log&&console.warn("sorry Eduardo, I cant add record! Error message: "+n.message),a.onFail&&a.onFail(null,null,n.message)}},add:function(a,b,c){try{var d=$dhx.dataDriver,e=a.db,f=d.dbs[e].schema[a.table];$dhx.dataDriver["public"][a.table].onBeforeAdd();var g="identify insert method "+$dhx.crypt.SHA2(JSON.stringify(a));if(console.time(g),"undefined"!=typeof f.foreign_keys&&$dhx.isObject(f.foreign_keys)&&Object.keys(f.foreign_keys).length>0)return console.timeEnd(g),void d._addCheckFkeys(a,b,c);console.timeEnd(g),d._addSaveOnTable(a,b,c)}catch(h){$dhx._enable_log&&console.warn("sorry Eduardo, I cant add record! Error message: "+h.message),a.onFail&&a.onFail(null,null,h.message)}},update:function(a){try{var b=$dhx.dataDriver,c=a.db,d=b.dbs[c].schema[a.table];$dhx.dataDriver["public"][a.table].onBeforeUpdate();var e="identify update method "+$dhx.crypt.SHA2(JSON.stringify(a));if(console.time(e),"undefined"!=typeof d.foreign_keys&&$dhx.isObject(d.foreign_keys)&&Object.keys(d.foreign_keys).length>0)return console.timeEnd(e),void b._updateCheckFkeys(a);console.timeEnd(e),b._updateSaveOnTable(a)}catch(f){$dhx._enable_log&&console.warn("sorry Eduardo, I cant add record! Error message: "+f.message),a.onFail&&a.onFail(null,null,f.message)}},_updateSaveOnTable:function(a){function b(a){return h=a,m.put(a)}try{var c=$dhx.dataDriver,d=a.db,e=parseInt(a.record_id),f=null,g=0,h={},i=c.dbs[d].schema[a.table],j=c.getTableSchema(a),k=(j.primary_key.keyPath,"record update. task: "+$dhx.crypt.SHA2(JSON.stringify(a)));console.time(k);var l=c.db(d).transaction(a.table,"readwrite"),m=l.objectStore(a.table),n=m.get(e);a.onSuccess=a.onSuccess||!1,a.onFail=a.onFail||!1,l.addEventListener("complete",function(a){$dhx._enable_log&&console.warn("tx update is completed")}),l.addEventListener("onerror",function(a){$dhx._enable_log&&console.log("error on transaction")}),l.addEventListener("abort",function(a){$dhx._enable_log&&console.warn("transaction aborted")}),n.onsuccess=function(j){var l=n.result;if("undefined"==typeof l)return console.timeEnd(k),$dhx._enable_log&&console.warn("sorry Eduardo, record "+e+" not found! "),void(a.onFail&&a.onFail(f,j,g));if($dhx.isObject(a.record)){$dhx._enable_log&&console.log("........... trying to update single record ");var m=c.validRecordUpdate(i,a.record);if(!$dhx.isObject(m))return console.timeEnd(k),$dhx._enable_log&&console.warn("sorry Eduardo, invalid record! Error message: "+m),void(a.onFail&&a.onFail(f,j,g));$dhx._enable_log&&console.log("preparing record ",m);for(var o in m)m.hasOwnProperty(o)&&(l[o]=m[o])}f=b(l),f.addEventListener("success",function(b){g=b.target.result;var i=c.dbs[d].root_topic+"."+a.table;$dhx.MQ.publish(i,{action:"update",target:"table",name:a.table,status:"success",message:"record updated",record_id:e,record:h,old_record:a.old_record}),console.timeEnd(k),$dhx._enable_log&&console.warn("executed"),$dhx._enable_log&&console.log("transaction complete      ",b),$dhx._enable_log&&console.warn("rows affected: "+typeof g!="undefined"?1:0),a.onSuccess&&a.onSuccess(f,b,g)}),f.addEventListener("error",function(b){$dhx._enable_log&&console.warn("error name: ",b.srcElement.error.name),$dhx._enable_log&&console.warn("	sorry Eduardo, couldnt update record. error message: "+b.srcElement.error.message),$dhx._enable_log&&console.warn("rows affected: 0"),console.timeEnd(k),a.onFail&&a.onFail(f,b,g)})}}catch(o){$dhx._enable_log&&console.warn("sorry Eduardo, I cant update by local id! Error message: "+o.message),a.onFail&&a.onFail(null,null,o.message)}},_updateCheckFkeys:function(a){try{var b=$dhx.dataDriver,c=a.db,d=b.dbs[c].schema[a.table],e=(a.isOnCreate,!1);if(!$dhx.isObject(a.record))return void($dhx._enable_log&&console.warn("sorry Eduardo, I cant parse the record payload"));$dhx._enable_log&&console.warn("........... checking fkeys for one record "+a.table);var f=b.validRecordUpdate(d,a.record);if(!$dhx.isObject(f))return void($dhx._enable_log&&console.warn("sorry Eduardo, invalid record, I cant check it fkeys! Error message: "+f));var g=$dhx.crypt.SHA2(JSON.stringify(f));if(b._total_fkeys_to_check[g]=Object.keys(d.foreign_keys).length,b._total_fkeys_checked[g]=0,0==b._total_fkeys_to_check[g])return $dhx._enable_log&&console.warn("does not need to check fkey for "+f),void b._updateSaveOnTable(a);for(var h in f)if(f.hasOwnProperty(h))for(var i in d.foreign_keys)d.foreign_keys.hasOwnProperty(i)&&i==h&&(e=!0);if(!e)return $dhx._enable_log&&console.warn("does not need to check fkey for "+f),void b._updateSaveOnTable(a);for(var i in d.foreign_keys)d.foreign_keys.hasOwnProperty(i)&&($dhx._enable_log&&console.warn("need to check fkey for "+i),b._checkFkey({db:a.db,table:d.foreign_keys[i].table,column:d.foreign_keys[i].column,value:f[d.foreign_keys[i].column],onSuccess:function(c,d,e){b._total_fkeys_checked[g]=b._total_fkeys_checked[g]+1,b._total_fkeys_checked[g]==b._total_fkeys_to_check[g]&&b._updateSaveOnTable(a)},onFail:function(b,c,e){$dhx._enable_log&&console.warn("sorry Eduardo,  value "+f[d.foreign_keys[i].column]+' not found at the "'+d.foreign_keys[i].table+'" foreign table! Error message: ',e),a.onFail&&a.onFail(b,c,e)}}))}catch(j){$dhx._enable_log&&console.warn("sorry Eduardo, I cant check fkey for updating record! Error message: "+j.message),a.onFail&&a.onFail(null,null,j.message)}},load:function(a){"use strict";try{var b=$dhx.dataDriver,c=a.db,d=0,e=(b.dbs[c].schema[a.table],[]);$dhx.showDirections("selecting table data, please wait ... "),console.time("select table data. task: "+$dhx.crypt.SHA2(JSON.stringify(a)));var f=b.db(c).transaction(a.table,"readonly"),g=f.objectStore(a.table),h=g.openCursor();a.onSuccess=a.onSuccess||!1,a.onFail=a.onFail||!1,f.addEventListener("complete",function(a){$dhx._enable_log&&console.warn("tx select is completed"),$dhx.hideDirections()}),f.addEventListener("onerror",function(a){$dhx._enable_log&&console.log("error on transaction"),$dhx.hideDirections()}),f.addEventListener("abort",function(a){$dhx._enable_log&&console.warn("transaction aborted"),$dhx.hideDirections()}),h.addEventListener("success",function(b){var c=b.target.result;c?(d+=1,e.push({key:c.key,primaryKey:c.primaryKey,record:c.value}),c["continue"]()):($dhx._enable_log&&console.warn("executed"),$dhx._enable_log&&console.log("transaction complete - data selected      ",b),$dhx._enable_log&&console.warn("rows affected: "+d),console.timeEnd("select table data. task: "+$dhx.crypt.SHA2(JSON.stringify(a))),a.onSuccess&&a.onSuccess(e,d,f,b),e=null)}),h.addEventListener("error",function(b){$dhx._enable_log&&console.warn("sorry Eduardo, couldnt fecth data! Error message: "+b),console.timeEnd("select table data. task: "+$dhx.crypt.SHA2(JSON.stringify(a))),a.onFail&&a.onFail(h,b,b.target.error.message),e=null})}catch(i){$dhx._enable_log&&console.warn("sorry Eduardo, I cant select data ! Error message: "+i.message),a.onFail&&a.onFail(null,null,i.message)}},count:function(a,b,c){"use strict";try{var d=$dhx.dataDriver,e=a.db;console.time("count operation "+a.table);var f=d.db(e).transaction(a.table,"readonly"),g=f.objectStore(a.table),h=(g.openCursor(),g.count());a.onSuccess=a.onSuccess||!1,a.onFail=a.onFail||!1,f.addEventListener("complete",function(a){$dhx._enable_log&&console.warn("tx count is completed")}),f.addEventListener("onerror",function(a){$dhx._enable_log&&console.log("error on transaction")}),f.addEventListener("abort",function(b){a.onFail&&a.onFail(f,b,b.target.error.message)}),h.addEventListener("success",function(b){console.timeEnd("count operation "+a.table),a.onSuccess&&a.onSuccess(f,b,h.result)}),h.addEventListener("error",function(b){console.timeEnd("count operation "+a.table),a.onFail&&a.onFail(f,b,b.target.error.message)})}catch(i){$dhx._enable_log&&console.warn("sorry Eduardo, I cant count data ! Error message: "+i.message),a.onFail&&a.onFail(null,null,i.message)}},del:function(a){"use strict";try{var b=$dhx.dataDriver,c=a.db,d="del operation "+a.table+" "+a.record_id;console.time(d);var e=b.db(c).transaction(a.table,"readwrite"),f=e.objectStore(a.table),g=f["delete"](parseInt(a.record_id));e.addEventListener("complete",function(a){$dhx._enable_log&&console.warn("tx del is completed")}),e.addEventListener("onerror",function(a){$dhx._enable_log&&console.log("error on transaction")}),e.addEventListener("abort",function(a){$dhx._enable_log&&console.warn("transaction aborted")}),g.onsuccess=function(f){console.timeEnd(d),$dhx.dataDriver["public"][a.table]._internal_cursor_position=0,$dhx.MQ.publish(b.dbs[c].root_topic+"."+a.table,{action:"delete",target:"table",name:a.table,status:"success",message:"record deleted",record_id:a.record_id}),$dhx._enable_log&&console.warn("executed"),$dhx._enable_log&&console.log("transaction complete - record deleted"),a.onSuccess&&a.onSuccess(e,f,a.record_id)},g.onerror=function(b){console.timeEnd(d),$dhx._enable_log&&console.warn("sorry Eduardo, I cant delete all records! Error message: "+b),a.onFail&&a.onFail(e,b,b.target.error.message)}}catch(h){$dhx._enable_log&&console.warn("sorry Eduardo, I cant delete the record! Error message: "+h.message),a.onFail&&a.onFail(null,null,h.message)}},clearAll:function(a,b,c){"use strict";try{var d=$dhx.dataDriver,e=a.db;console.time("clearAll operation "+a.table);var f=d.db(e).transaction(a.table,"readwrite"),g=f.objectStore(a.table),h=g.clear();a.onSuccess=a.onSuccess||!1,a.onFail=a.onFail||!1,f.addEventListener("complete",function(a){$dhx._enable_log&&console.warn("tx cearlAll is completed")}),f.addEventListener("onerror",function(a){$dhx._enable_log&&console.log("error on transaction")}),f.addEventListener("abort",function(a){$dhx._enable_log&&console.warn("transaction aborted")}),h.addEventListener("success",function(b){console.timeEnd("clearAll operation "+a.table),$dhx._enable_log&&console.warn("executed"),$dhx._enable_log&&console.log("transaction complete - table is clear"),$dhx.MQ.publish(d.dbs[e].root_topic+"."+a.table,{action:"clear",target:"table",name:a.table,status:"success",message:"table is empty"}),a.onSuccess&&a.onSuccess(f,b)}),h.addEventListener("error",function(b){console.timeEnd("clearAll operation "+a.table),$dhx._enable_log&&console.warn("sorry Eduardo, I cant delete all records! Error message: "+b),a.onFail&&a.onFail(f,b,b.target.error.message)})}catch(i){$dhx._enable_log&&console.warn("sorry Eduardo, I cant delete all records! Error message: "+i.message),a.onFail&&a.onFail(null,null,i.message)}},setCursor:function(a){"use strict";try{var b=$dhx.dataDriver,c=a.db,d="setCursor operation "+a.table;console.time(d),$dhx.dataDriver["public"][a.table].onBeforeCursorChange(e);var e=parseInt(a.record_id),f=b.db(c).transaction(a.table,"readonly"),g=f.objectStore(a.table),h=g.get(e);a.onSuccess=a.onSuccess||!1,a.onFail=a.onFail||!1,f.addEventListener("complete",function(a){$dhx._enable_log&&console.warn("tx setCursor is completed")}),f.addEventListener("onerror",function(a){$dhx._enable_log&&console.log("error on transaction")}),f.addEventListener("abort",function(a){$dhx._enable_log&&console.warn("transaction aborted")}),h.onsuccess=function(b){var c=h.result;return"undefined"==typeof c?(console.timeEnd(d),$dhx._enable_log&&console.warn("sorry Eduardo, record "+e+" not found! "),void(a.onFail&&a.onFail(h,b,null))):($dhx.dataDriver["public"][a.table]._internal_cursor_position=e,console.timeEnd(d),$dhx.dataDriver["public"][a.table].onAfterCursorChange(e,a.table),a.onSuccess&&a.onSuccess(h,b,c),void 0)}}catch(i){$dhx._enable_log&&console.warn("sorry Eduardo, I cant setCursor ! Error message: "+i.message),a.onFail&&a.onFail(null,null,i.message)}},getCursor:function(a){"use strict";try{var b=$dhx.dataDriver,c=a.db,d="getCursor operation "+a.table;if(console.time(d),$dhx.dataDriver["public"][a.table]._internal_cursor_position>0)console.timeEnd(d),a.onSuccess&&a.onSuccess($dhx.dataDriver["public"][a.table]._internal_cursor_position);else{var e=b.db(c).transaction(a.table,"readonly"),f=e.objectStore(a.table),g=f.openCursor();a.onSuccess=a.onSuccess||!1,a.onFail=a.onFail||!1,e.addEventListener("complete",function(a){$dhx._enable_log&&console.warn("tx getCursor is completed")}),e.addEventListener("onerror",function(a){$dhx._enable_log&&console.log("error on transaction")}),e.addEventListener("abort",function(b){a.onFail&&a.onFail(e,b,b.target.error.message)}),g.addEventListener("success",function(b){var c=b.target.result;c?($dhx.dataDriver["public"][a.table]._internal_cursor_position=c.key,a.onSuccess&&a.onSuccess(c.key,e,b)):a.onSuccess&&a.onSuccess($dhx.dataDriver["public"][a.table]._internal_cursor_position,e,b),console.timeEnd(d)}),g.addEventListener("error",function(b){console.timeEnd(d),a.onFail&&a.onFail(e,b,b.target.error.message)})}}catch(h){$dhx._enable_log&&console.warn("sorry Eduardo, I cant getCursor ! Error message: "+h.message),a.onFail&&a.onFail(null,null,h.message)}},getCurrentRecord:function(a){"use strict";try{var b=$dhx.dataDriver,c=a.db,d="getCurrentRecord operation "+a.table;if(console.time(d),0==$dhx.dataDriver["public"][a.table]._internal_cursor_position)return console.timeEnd(d),$dhx._enable_log&&console.warn("sorry Eduardo, record "+$dhx.dataDriver["public"][a.table]._internal_cursor_position+" not found! "),void(a.onFail&&a.onFail(g,event,"not found"));var e=b.db(c).transaction(a.table,"readonly"),f=e.objectStore(a.table),g=f.get($dhx.dataDriver["public"][a.table]._internal_cursor_position);a.onSuccess=a.onSuccess||!1,a.onFail=a.onFail||!1,e.addEventListener("complete",function(a){$dhx._enable_log&&console.warn("tx getCurrentRecord is completed")}),e.addEventListener("onerror",function(a){$dhx._enable_log&&console.log("error on transaction")}),e.addEventListener("abort",function(a){$dhx._enable_log&&console.warn("transaction aborted")}),g.addEventListener("success",function(b){var c=g.result;return"undefined"==typeof c?(console.timeEnd(d),$dhx._enable_log&&console.warn("sorry Eduardo, record "+$dhx.dataDriver["public"][a.table]._internal_cursor_position+" not found! "),void(a.onFail&&a.onFail(g,b,"not found"))):(console.timeEnd(d),void(a.onSuccess&&a.onSuccess(c,g,b)))}),g.addEventListener("error",function(b){$dhx._enable_log&&console.warn("sorry Eduardo, I cant getCurrentRecord data ! Error message: "+b.target.error.message),console.timeEnd(d),a.onFail&&a.onFail(g,b,b.target.error.message)})}catch(h){$dhx._enable_log&&console.warn("sorry Eduardo, I cant getCurrentRecord data ! Error message: "+h.message),a.onFail&&a.onFail(null,null,h.message)}},getRecord:function(a){"use strict";try{var b=$dhx.dataDriver,c=a.db,d="getRecord operation "+a.table;console.time(d);var e=b.db(c).transaction(a.table,"readonly"),f=e.objectStore(a.table),g=f.get(parseInt(a.record_id));a.onSuccess=a.onSuccess||!1,a.onFail=a.onFail||!1,e.addEventListener("complete",function(a){$dhx._enable_log&&console.warn("tx getRecord is completed")}),e.addEventListener("onerror",function(a){$dhx._enable_log&&console.log("error on transaction")}),e.addEventListener("abort",function(a){$dhx._enable_log&&console.warn("transaction aborted")}),g.addEventListener("success",function(b){var c=g.result;return"undefined"==typeof c?(console.timeEnd(d),$dhx._enable_log&&console.warn("sorry Eduardo, record "+a.record_id+" not found! "),void(a.onFail&&a.onFail(g,b,"not found"))):(console.timeEnd(d),void(a.onSuccess&&a.onSuccess(c,g,b)))}),g.addEventListener("error",function(b){$dhx._enable_log&&console.warn("sorry Eduardo, I cant getRecord data ! Error message: "+b.target.error.message),console.timeEnd(d),a.onFail&&a.onFail(g,b,b.target.error.message)})}catch(h){$dhx._enable_log&&console.warn("sorry Eduardo, I cant getRecord data ! Error message: "+h.message),a.onFail&&a.onFail(null,null,h.message)}},_syncGridData:function(a,b){"use strict";var c=$dhx.dataDriver;$dhx.dataDriver["public"][a.table].load(function(b,d,e,f){$dhx.MQ.publish(c.dbs[a.db].root_topic+"."+a.table,{action:"load",target:"table",name:a.table,status:"success",message:"sync grid",records:b}),a.onSuccess&&a.onSuccess(d)},function(b,c,d,e){a.onFail&&a.onFail(e)})},_syncComboData:function(a,b){"use strict";var c=$dhx.dataDriver;$dhx.dataDriver["public"][a.table].load(function(d,e,f,g){$dhx.MQ.publish(c.dbs[a.db].root_topic+"."+a.table,{action:"load",target:"table",name:a.table,target_id:b._id,status:"success",message:"sync combo",records:d}),a.onSuccess&&a.onSuccess(e)},function(b,c,d,e){a.onFail&&a.onFail(e)})},_syncSelectData:function(a,b){"use strict";var c=$dhx.dataDriver;$dhx.dataDriver["public"][a.table].load(function(d,e,f,g){$dhx.MQ.publish(c.dbs[a.db].root_topic+"."+a.table,{action:"load",target:"table",name:a.table,target_id:b._id,status:"success",message:"sync select",records:d}),a.onSuccess&&a.onSuccess(e)},function(b,c,d,e){a.onFail&&a.onFail(e)})},_syncSelectGridData:function(a,b){"use strict";var c=$dhx.dataDriver;$dhx.dataDriver["public"][a.table].load(function(d,e,f,g){
$dhx.MQ.publish(c.dbs[a.db].root_topic+"."+a.table,{action:"load",target:"table",name:a.table,target_id:b._id,status:"success",message:"sync selectGrid",records:d}),a.onSuccess&&a.onSuccess(e)},function(b,c,d,e){a.onFail&&a.onFail(e)})},_prepareGridSaveOnEdit:function(a,b){"use strict";var c=$dhx.dataDriver;b.attachEvent("onEditCell",function(d,e,f,g,h){var i=c.getTableSchema(a),j=b.getColumnId(f);if(0==d)return!0;if(1==d&&b.editor.obj){var k=b.editor.obj,l=i.columns[j].format;return c._setInputMask(k,l),!0}if(2==d){if(g!=h){$dhx.showDirections("saving data ... "),b.setRowTextBold(e);var m={},n={};m[b.getColumnId(f)]=g,n[b.getColumnId(f)]=h;var o=i.columns[j].validation;if(i.columns[j].required&&""==g)return dhtmlx.message({type:"error",text:"this field can not be blank - data was not updated"}),b.cells(e,f).setValue(h),b.setRowTextNormal(e),$dhx.hideDirections(),!1;if(""!=o&&!c._validateValueByType(g,o,j))return b.cells(e,f).setValue(h),$dhx.hideDirections(),!1;$dhx.dataDriver["public"][a.table].update(e,m,n,function(){dhtmlx.message({text:"data updated"}),b.cells(e,f).setValue(g),b.setRowTextNormal(e),$dhx.hideDirections()},function(){dhtmlx.message({type:"error",text:"data was not updated"}),b.cells(e,f).setValue(h),b.setRowTextNormal(e),$dhx.hideDirections()})}return!1}})},_syncSelect:function(a,b,c){"use strict";try{var d=$dhx.dataDriver;$dhx._enable_log&&console.log("this component is a select"),b._id=c.component_id,b._type=c.type,b._subscriber=function(e,f){var g=d.getTableSchema(a);g.primary_key.keyPath;if("table"==f.target&&f.name==a.table)if($dhx._enable_log&&console.warn(c.component_id+" received message sent to it: ",f.target,f.name),"add"==f.action&&"record added"==f.message)f.records.forEach(function(c,d,e){var f={};for(i in c)c.hasOwnProperty(i)&&(f[i]=c[i]);a.$init&&a.$init(f),console.log(new Option(f.text,f.value)),b.options.add(new Option(f.text,f.value))}),$dhx._enable_log&&console.warn(c.component_id+" updated ");else if("update"==f.action&&"record updated"==f.message);else if("delete"==f.action&&"record deleted"==f.message)console.log(b.options);else if("clear"==f.action&&"table is empty"==f.message)b.clearAll(),$dhx._enable_log&&console.warn(c.component_id+" updated ");else if("load"==f.action&&"sync select"==f.message){try{var h=f.records,g=$dhx.dataDriver.getTableSchema(a);g.primary_key.keyPath;h.forEach(function(c,d,e){var f={};for(i in c.record)c.record.hasOwnProperty(i)&&(f[i]=c.record[i]);a.$init&&a.$init(f),b.options.add(new Option(f.text,f.value))})}catch(j){console.log(j.stack)}$dhx._enable_log&&console.warn(c.component_id+" updated ")}},b._subscriber_token=$dhx.MQ.subscribe($dhx.dataDriver.dbs[a.db].root_topic+"."+a.table,b._subscriber),d._syncSelectData(a,b),$dhx._enable_log&&console.warn(c.component_id," is synced")}catch(e){console.log(e.stack)}},_syncSelectGrid:function(a,b,c){"use strict";try{var d=$dhx.dataDriver;$dhx._enable_log&&console.log("this component is a selectGrid"),b._id=c.component_id,b._type=c.type,b._subscriber=function(e,f){var g=d.getTableSchema(a);g.primary_key.keyPath,$dhx.dataDriver._getColumnsId(a).split(",");if("table"==f.target&&f.name==a.table)if($dhx._enable_log&&console.warn(c.component_id+" received message sent to it: ",f.target,f.name),"add"==f.action&&"record added"==f.message)f.records.forEach(function(c,d,e){var f={};for(i in c)c.hasOwnProperty(i)&&(f[i]=c[i]);a.$init&&a.$init(f),b.put(f.value,f.text)}),$dhx._enable_log&&console.warn(c.component_id+" updated ");else if("update"==f.action&&"record updated"==f.message){var h={};for(var i in f.record)f.record.hasOwnProperty(i)&&(h[i]=f.record[i]);a.$init&&a.$init(h);var j={};for(var i in f.old_record)f.old_record.hasOwnProperty(i)&&(j[i]=f.old_record[i]);a.$init&&a.$init(j),b.values.forEach(function(a,c,d){a==j.value&&(b.keys[c]=h.value,b.values[c]=h.text)})}else if("delete"==f.action&&"record deleted"==f.message)console.log(b.options);else if("clear"==f.action&&"table is empty"==f.message)b.clearAll(),$dhx._enable_log&&console.warn(c.component_id+" updated ");else if("load"==f.action&&"sync selectGrid"==f.message){try{var k=f.records,g=$dhx.dataDriver.getTableSchema(a);g.primary_key.keyPath,$dhx.dataDriver._getColumnsId(a).split(",");k.forEach(function(c,d,e){var f={};for(i in c.record)c.record.hasOwnProperty(i)&&(f[i]=c.record[i]);a.$init&&a.$init(f),b.put(f.value,f.text)})}catch(l){console.log(l.stack)}$dhx._enable_log&&console.warn(c.component_id+" updated ")}},b._subscriber_token=$dhx.MQ.subscribe($dhx.dataDriver.dbs[a.db].root_topic+"."+a.table,b._subscriber),d._syncSelectGridData(a,b),$dhx._enable_log&&console.warn(c.component_id," is synced")}catch(e){console.log(e.stack)}},_syncCombo:function(a,b,c){"use strict";try{var d=$dhx.dataDriver;$dhx._enable_log&&console.log("this component is a combo"),b._id=c.component_id,b._type=c.type,b._subscriber=function(e,f){var g=d.getTableSchema(a);g.primary_key.keyPath,$dhx.dataDriver._getColumnsId(a).split(",");if("table"==f.target&&f.name==a.table)if($dhx._enable_log&&console.warn(c.component_id+" received message sent to it: ",f.target,f.name),"add"==f.action&&"record added"==f.message){var h=[];f.records.forEach(function(b,c,d){var e={};for(i in b)b.hasOwnProperty(i)&&(e[i]=b[i]);a.$init&&a.$init(e),h.push([e.value,e.text])}),b.addOption(h),$dhx._enable_log&&console.warn(c.component_id+" updated ")}else if("update"==f.action&&"record updated"==f.message)$dhx._enable_log&&console.warn(c.component_id+" updated ");else if("delete"==f.action&&"record deleted"==f.message)$dhx._enable_log&&console.warn(c.component_id+" updated ");else if("clear"==f.action&&"table is empty"==f.message)b.clearAll(),$dhx._enable_log&&console.warn(c.component_id+" updated ");else if("load"==f.action&&"sync combo"==f.message){try{var h=f.records,j=[],g=$dhx.dataDriver.getTableSchema(a);g.primary_key.keyPath,$dhx.dataDriver._getColumnsId(a).split(",");h.forEach(function(b,c,d){var e={};for(i in b.record)b.record.hasOwnProperty(i)&&(e[i]=b.record[i]);a.$init&&a.$init(e),j.push([e.value,e.text])}),b.clearAll(!0),b.addOption(j)}catch(k){console.log(k.stack)}$dhx._enable_log&&console.warn(c.component_id+" updated ")}},b._subscriber_token=$dhx.MQ.subscribe($dhx.dataDriver.dbs[a.db].root_topic+"."+a.table,b._subscriber),d._syncComboData(a,b),$dhx._enable_log&&console.warn(c.component_id," is synced")}catch(e){console.log(e.stack)}},_syncGrid:function(a,b,c){"use strict";try{var d=$dhx.dataDriver;$dhx._enable_log&&console.log("this component is a grid");var e=d.getTableSchema(a);e.primary_key.keyPath,$dhx.dataDriver._getColumnsId(a).split(",");if(b._subscriber=function(e,f){var g=d.getTableSchema(a),h=g.primary_key.keyPath,i=$dhx.dataDriver._getColumnsId(a).split(",");if("table"==f.target&&f.name==a.table)if($dhx._enable_log&&console.warn(c.component_id+" received message about it synced table: ",f.target,f.name),"add"==f.action&&"record added"==f.message){var j=0;f.records.forEach(function(a,d,e){var f=[];i.forEach(function(b,c,d){f[c]=a[b]}),b.addRow(a[h],f),j=a[h],$dhx._enable_log&&console.warn(c.component_id+" updated ")}),b.selectRowById(j,!1,!0,!0)}else if("update"==f.action&&"record updated"==f.message){for(var k in f.record)if(f.record.hasOwnProperty(k)){var l=b.getColIndexById(k);b.cells(f.record_id,l).setValue(f.record[k])}$dhx._enable_log&&console.warn(c.component_id+" updated ")}else if("delete"==f.action&&"record deleted"==f.message)b.deleteRow(f.record_id),$dhx._enable_log&&console.warn(c.component_id+" updated ");else if("select"==f.action&&"selected record"==f.message)b.selectRowById(f.record_id,!1,!0,!1),$dhx._enable_log&&console.warn(c.component_id+" updated ");else if("clear"==f.action&&"table is empty"==f.message)b.clearAll(),$dhx._enable_log&&console.warn(c.component_id+" updated ");else if("load"==f.action&&"sync grid"==f.message){try{var m=f.records,f={rows:[]},g=$dhx.dataDriver.getTableSchema(a),h=g.primary_key.keyPath,i=$dhx.dataDriver._getColumnsId(a).split(",");m.forEach(function(a,b,c){var d=[];i.forEach(function(b,c,e){d[c]=a.record[b]}),f.rows.push({id:a.record[h],data:d})}),b.parse(f,"json")}catch(n){console.log(n.stack)}$dhx._enable_log&&console.warn(c.component_id+" updated ")}},a.auto_configure&&(b.setHeader($dhx.dataDriver._getColumnsHeader(a)),b.setColTypes($dhx.dataDriver._getColumnsType(a)),b.setColSorting($dhx.dataDriver._getColumnsSorting(a)),b.setColAlign($dhx.dataDriver._getColumnsAlign(a)),b.setInitWidths($dhx.dataDriver._getColumnsWidth(a))),b.setColumnIds($dhx.dataDriver._getColumnsId(a)),a.auto_configure){b.init(),b.fk_combos=[];for(var f in e.foreign_keys){var g=e.foreign_keys[f].table,h=e.columns[f].foreign_column_value,i=e.columns[f].foreign_column_name,j=(e.foreign_keys[f].column,b.getColIndexById(f));b.fk_combos[f]=b.getCombo(j),$dhx.dataDriver["public"][g].sync.selectGrid({component:b.fk_combos[f],component_id:"_fk_bound_"+g+"_selectGrid_"+j+"_"+f,$init:function(a){a.value=a[h],a.text=a[i]},onSuccess:function(){},onFail:function(){}})}}a.paginate||b.enableSmartRendering(!0),b.setDateFormat("%Y-%m-%d"),b.attachEvent("onRowSelect",function(c,d){$dhx.dataDriver["public"][a.table].setCursor(c,function(){},function(){b.clearSelection()})}),b._subscriber_token=$dhx.MQ.subscribe($dhx.dataDriver.dbs[a.db].root_topic+"."+a.table,b._subscriber),b.saveOnEdit&&d._prepareGridSaveOnEdit(a,b),d._syncGridData(a,b),$dhx._enable_log&&console.warn(c.component_id," is synced")}catch(k){console.log(k.stack)}},sync:function(a){"use strict";try{var b=$dhx.dataDriver;if("undefined"==typeof a.db||0===a.db.length)return a.onFail&&a.onFail("db is missing when creating a dataset"),!1;if("undefined"==typeof a.table||0===a.table.length)return a.onFail&&a.onFail("table is missing when creating a dataset"),!1;if("undefined"==typeof a.type||0===a.type.length)return a.onFail&&a.onFail("type is missing when creating a dataset"),!1;if("undefined"==typeof a.component)return a.onFail&&a.onFail("component is missing when syncing"),!1;if(!$dhx.isObject(a.component))return a.onFail&&a.onFail("component is not an object"),!1;a.onSuccess=a.onSuccess||!1,a.onFail=a.onFail||!1,$dhx._enable_log&&console.warn("called sync for: "+a.component_id+" on "+a.table);for(var c=$dhx.dataDriver["public"][a.table]._synced_components,d=0;d<c.length;d++){var e=c[d];if(e.component_id==a.component_id)return $dhx._enable_log&&console.warn(e.component_id+" object already exist on memory, please remove it first"),void(a.onFail&&a.onFail(e.component_id+" object already exist on memory, please remove it first"))}$dhx._enable_log&&console.log("pushing: "+a.component_id);var f={component_id:a.component_id,component:a.component,type:a.type,synced_table:a.table};"function"==typeof a.$init&&(f.$init=a.$init),$dhx.dataDriver["public"][a.table]._synced_components.push(f),$dhx.dataDriver["public"][a.table]._synced_components.forEach(function(c,d,e){if(c.component_id==a.component_id){var f=c.component;"tree"==c.type?a.onFail&&a.onFail("tree can not be synced"):"combo"==c.type?b._syncCombo(a,f,c):"select"==c.type?b._syncSelect(a,f,c):"selectGrid"==c.type?b._syncSelectGrid(a,f,c):"grid"==c.type?b._syncGrid(a,f,c):"form"==c.type?a.onFail&&a.onFail("form can not be synced"):a.onFail&&a.onFail("unknow component when syncing")}})}catch(g){$dhx._enable_log&&console.warn("sorry Eduardo, I cant sync "+a.component_id+" data ! Error message: "+g.message,g.stack),a.onFail&&a.onFail(null,null,g.message)}},bind:function(a){"use strict";try{var b=$dhx.dataDriver;if("undefined"==typeof a.db||0===a.db.length)return a.onFail&&a.onFail("db is missing when binding"),!1;if("undefined"==typeof a.table||0===a.table.length)return a.onFail&&a.onFail("table is missing when binding"),!1;if("undefined"==typeof a.type||0===a.type.length)return a.onFail&&a.onFail("type is missing when binding"),!1;if("undefined"==typeof a.component)return a.onFail&&a.onFail("component is missing binding"),!1;if(!$dhx.isObject(a.component))return a.onFail&&a.onFail("component is not an object"),!1;a.onSuccess=a.onSuccess||!1,a.onFail=a.onFail||!1,$dhx._enable_log&&console.warn("called bind for: "+a.component_id+" on "+a.table);for(var c=$dhx.dataDriver["public"][a.table]._bound_components,d=0;d<c.length;d++){var e=c[d];if(e.component_id==a.component_id)return $dhx._enable_log&&console.warn(e.component_id+" object already exist on memory, please remove it first"),void(a.onFail&&a.onFail(e.component_id+" object already exist on memory, please remove it first"))}a.$init=a.$init||!1,$dhx._enable_log&&console.log("pushing: "+a.component_id);var f={component_id:a.component_id,component:a.component,prepare:a.prepare,type:a.type};"function"==typeof a.$init&&(f.$init=a.$init),$dhx.dataDriver["public"][a.table]._bound_components.push(f),$dhx.dataDriver["public"][a.table]._bound_components.forEach(function(c,d,e){if(c.component_id==a.component_id){var f=c.component;if("form"==c.type){var g=!1;if(f._id=c.component_id,f._type=c.type,"undefined"!=typeof c.prepare&&"undefined"!=typeof c.prepare.settings&&(g=!0,$dhx.dhtmlx.prepareForm(c.component_id,c.prepare.settings,c.component),$dhx.dhtmlx.formFields[c.component_id].forEach(function(b,c,d){if("combo"==b.type){if("undefined"!=typeof b.dhx_table&&"undefined"!=typeof b.dhx_prop_text&&"undefined"!=typeof b.dhx_prop_value){var e=f.getCombo(b.name),g=document.createElement("img");g.setAttribute("class","dhx_crud_rapid_button"),e.DOMParent.appendChild(g);var h=$dhx.ui.data.model.db[a.db].schema[b.dhx_table];g.onclick=function(){$dhx.ui.crud.simple.View.FormWindow.render({database:a.db,table:b.dhx_table,schema:h})},$dhx.dataDriver["public"][b.dhx_table].sync.combo({component:e,component_id:f._id+"_combo_"+b.name,$init:function(a){a.value=a[b.dhx_prop_value],a.text=a[b.dhx_prop_text]},onSuccess:function(){},onFail:function(){}})}}else if("select"==b.type&&"undefined"!=typeof b.dhx_table&&"undefined"!=typeof b.dhx_prop_text&&"undefined"!=typeof b.dhx_prop_value){var i=f.getSelect(b.name);$dhx.dataDriver["public"][b.dhx_table].sync.select({component:i,component_id:f._id+"_select_"+b.name,$init:function(a){a.value=a[b.dhx_prop_value],a.text=a[b.dhx_prop_text]},onSuccess:function(){},onFail:function(){}})}})),1==f.isEditing){try{f.hideItem("x_special_button_save")}catch(h){}$dhx.dataDriver["public"][a.table].getCurrentRecord(function(b){var c={};for(i in b)b.hasOwnProperty(i)&&"id"!=i&&(c[i]=b[i]);a.$init&&a.$init(c),f.setFormData(c)},function(){})}else try{f.hideItem("x_special_button_update")}catch(h){}f.attachEvent("onButtonClick",function(a){"x_special_button_save"==a?f.save():"x_special_button_update"==a&&f.update()}),f.save=function(c,d,e){g?$dhx.dhtmlx.validateForm(a.component_id,f)&&b._bound_form_save(a,f,c,d,e):b._bound_form_save(a,f,c,d,e)},f.update=function(c,d,e){g?$dhx.dhtmlx.validateForm(a.component_id,f)&&b._bound_form_update(a,f,c,d,e):b._bound_form_update(a,f,c,d,e)},f.setFocusOnFirstActive(),f._subscriber=function(d,e){if("table"==e.target&&e.name==a.table&&($dhx._enable_log&&console.warn(c.component_id+" received message about it bound table: ",e.target,e.name),"add"==e.action&&"record added"==e.message)){var f=b.getTableSchema(a);f.primary_key.keyPath,$dhx.dataDriver._getColumnsId(a).split(",")}},f._subscriber_token=$dhx.MQ.subscribe($dhx.dataDriver.dbs[a.db].root_topic+"."+a.table,f._subscriber),a.onSuccess&&a.onSuccess("bound"),$dhx._enable_log&&console.warn(c.component_id," is bound")}else a.onFail&&a.onFail("unknow component when binding")}})}catch(g){$dhx._enable_log&&console.warn("sorry Eduardo, I cant bind "+a.component_id+" data ! Error message: "+g.message),a.onFail&&a.onFail(null,null,g.message)}},unbind:function(a){"use strict";try{$dhx.dataDriver;if("undefined"==typeof a.db||0===a.db.length)return a.onFail&&a.onFail("db is missing when syncing"),!1;if("undefined"==typeof a.table||0===a.table.length)return a.onFail&&a.onFail("table is missing when syncing"),!1;if("undefined"==typeof a.type||0===a.type.length)return a.onFail&&a.onFail("type is missing when syncing"),!1;if("undefined"==typeof a.component)return a.onFail&&a.onFail("component is missing when syncing"),!1;if(!$dhx.isObject(a.component))return a.onFail&&a.onFail("component is not an object"),!1;$dhx._enable_log&&console.warn("called unbind for: "+a.component_id+" on "+a.table);for(var b=$dhx.dataDriver["public"][a.table]._bound_components,c=0;c<b.length;c++){var d=b[c],e=d.component;if(d.component_id==a.component_id)return $dhx.dhtmlx.formFields[d.component_id].forEach(function(a,b,c){if("combo"==a.type){if("undefined"!=typeof a.dhx_table){e.getCombo(a.name);$dhx.dataDriver["public"][a.dhx_table].unsync.combo({component:e,component_id:e._id+"_combo_"+a.name,onSuccess:function(){},onFail:function(){}})}}else if("select"==a.type&&"undefined"!=typeof a.dhx_table){e.getSelect(a.name);$dhx.dataDriver["public"][a.dhx_table].unsync.select({component:e,component_id:e._id+"_select_"+a.name,onSuccess:function(){},onFail:function(){}})}}),$dhx._enable_log&&console.warn(d.component_id+" object exist on memory. now it was unbound"),$dhx.dataDriver["public"][a.table]._bound_components.splice(c,1),$dhx.MQ.unsubscribe(e._subscriber_token),void(a.onSuccess&&a.onSuccess(d.component_id+" object exist on memory. now it was unbound"))}$dhx._enable_log&&console.warn("component not found. it was not unbound"),a.onFail&&a.onFail("component not found. it was not unbound")}catch(f){$dhx._enable_log&&console.warn("sorry Eduardo, I cant unbind "+a.component_id+"! Error message: "+f.message),a.onFail&&a.onFail(null,null,f.message)}},unsync:function(a){"use strict";try{var b=$dhx.dataDriver;if("undefined"==typeof a.db||0===a.db.length)return a.onFail&&a.onFail("db is missing when unsyncing"),!1;if("undefined"==typeof a.table||0===a.table.length)return a.onFail&&a.onFail("table is missing when unsyncing"),!1;if("undefined"==typeof a.type||0===a.type.length)return a.onFail&&a.onFail("type is missing when unsyncing"),!1;if("undefined"==typeof a.component)return a.onFail&&a.onFail("component is missing when syncing"),!1;if(!$dhx.isObject(a.component))return a.onFail&&a.onFail("component is not an object"),!1;$dhx._enable_log&&console.warn("called unsync for: "+a.component_id+" on "+a.table);for(var c=$dhx.dataDriver["public"][a.table]._synced_components,d=0;d<c.length;d++){var e=c[d],f=e.component;if(e.component_id==a.component_id){if("grid"==a.type){var g=b.getTableSchema(a);g.primary_key.keyPath;for(var h in g.foreign_keys){var i=g.foreign_keys[h].table,j=(g.foreign_keys[h].column,f.getColIndexById(h));f.fk_combos[h]=f.getCombo(j),$dhx.dataDriver["public"][i].unsync.selectGrid({component:f.fk_combos[h],component_id:"_fk_bound_"+i+"_selectGrid_"+j+"_"+h,onSuccess:function(){},onFail:function(){}})}return $dhx._enable_log&&console.warn(e.component_id+" object exist on memory. now it was unsynced"),$dhx.dataDriver["public"][a.table]._synced_components.splice(d,1),$dhx.MQ.unsubscribe(f._subscriber_token),void(a.onSuccess&&a.onSuccess(e.component_id+" object exist on memory. now it was unsynced"))}return $dhx._enable_log&&console.warn(e.component_id+" object exist on memory. now it was unsynced"),$dhx.dataDriver["public"][a.table]._synced_components.splice(d,1),$dhx.MQ.unsubscribe(f._subscriber_token),void(a.onSuccess&&a.onSuccess(e.component_id+" object exist on memory. now it was unsynced"))}}$dhx._enable_log&&console.warn("component not found. it was not unsynced"),a.onFail&&a.onFail("component not found. it was not unsynced")}catch(k){$dhx._enable_log&&console.warn("sorry Eduardo, I cant unsync "+a.component_id+"! Error message: "+k.message),a.onFail&&a.onFail(null,null,k.message)}},_bound_form_save:function(a,b,c,d,e){var f=$dhx.dataDriver;c=c||b.getFormData(),clone={};for(var g in c)if(c.hasOwnProperty(g))if(field=$dhx.dhtmlx.getFormItem(g,b._id),"calendar"==field.type){var h=new Date(c[g]),i=h.getFullYear(),j=h.getMonth()+1,k=h.getDate();1==j.toString().length&&(j="0"+j),1==k.toString().length&&(k="0"+k),clone[g]=i+"-"+j+"-"+k}else clone[g]=c[g];d=d||!1,e=e||!1,$dhx._enable_log&&console.warn("trying to save new record: ",clone),b.lock(),$dhx.dataDriver["public"][a.table].add(clone,function(a,c,e){b.unlock();var f={};b.forEachItem(function(a){f[a]=""}),b.setFormData(f),$dhx._enable_log&&console.warn("record saved. rows_affected: ",e),d?d():""},function(c,d,g){f._saveRecordCheckError(b,d,a),b.unlock(),$dhx._enable_log&&console.warn("record not saved. rows_affected: ",g),e?e():""})},_bound_form_update:function(a,b,c,d,e){var f=$dhx.dataDriver;c=c||b.getFormData(),clone={},schema=f.getTableSchema(a),primary_key=schema.primary_key.keyPath,record_id=c[primary_key];for(var g in c)if(c.hasOwnProperty(g))if(field=$dhx.dhtmlx.getFormItem(g,b._id),"calendar"==field.type){var h=new Date(c[g]),i=h.getFullYear(),j=h.getMonth()+1,k=h.getDate();1==j.toString().length&&(j="0"+j),1==k.toString().length&&(k="0"+k),clone[g]=i+"-"+j+"-"+k}else clone[g]=c[g];d=d||!1,e=e||!1,delete clone[primary_key],$dhx._enable_log&&console.warn("trying to save existing record: ",clone),b.lock(),$dhx.dataDriver["public"][a.table].update(record_id,clone,null,function(a,c,e){b.unlock(),$dhx._enable_log&&console.warn("record saved. rows_affected: ",e),d?d():""},function(c,d,g){f._saveRecordCheckError(b,d,a),b.unlock(),$dhx._enable_log&&console.warn("record not saved. rows_affected: ",g),e?e():""})},_extractColumnFromErrorMessage:function(a){var b=($dhx.dataDriver,/'(.*)'/),a=a.match(b);return null!=a?a[0].replace(b,"$1"):""},_saveRecordCheckError:function(a,b,c){"use strict";var d=$dhx.dataDriver,e=b.target.error.name,f=b.target.error.message,g=d._extractColumnFromErrorMessage(f),h=a.getItemLabel(g),i=a.getItemType(g),j=null;if("combo"==i)j=a.getCombo(g),j.openSelect();else if("editor"==i);else if("multiselect"==i){j=a.getInput(g);var k=$dhx.dhtmlx.getFormItem(g,a._id);d._setInputHighlighted(k,a)}else if("select"==i){a.getSelect(g);var k=$dhx.dhtmlx.getFormItem(g,a._id);d._setInputHighlighted(k,a)}else{j=a.getInput(g);var k=$dhx.dhtmlx.getFormItem(g,a._id);d._setInputHighlighted(k,a)}"ConstraintError"==e&&f.indexOf("at least one key does not satisfy the uniqueness requirements")>-1&&dhtmlx.message({type:"error",text:"the table "+c.table+" does not accept duplicated value for "+h})},exists:function(){"use strict";$dhx.dataDriver},filter:function(){"use strict";$dhx.dataDriver},first:function(a){var b=$dhx.dataDriver,c=a.db,d=(b.dbs[c].schema[a.table],b.getTableSchema(a)),e=(d.primary_key.keyPath,"get first record. task: "+$dhx.crypt.SHA2(JSON.stringify(a)));console.time(e);var f=b.db(c).transaction(a.table,"readonly"),g=f.objectStore(a.table);a.onSuccess=a.onSuccess||!1,a.onFail=a.onFail||!1,f.addEventListener("complete",function(a){$dhx._enable_log&&console.warn("executed"),$dhx._enable_log&&console.log("transaction complete",a),console.timeEnd(e),$dhx._enable_log&&console.warn("tx first record is completed")}),f.addEventListener("onerror",function(b){console.timeEnd(e),a.onFail&&a.onFail(f,b,b.target.error.message),$dhx._enable_log&&console.log("error on transaction")}),f.addEventListener("abort",function(a){console.timeEnd(e),$dhx._enable_log&&console.warn("transaction aborted")});var h=g.openCursor();h.onsuccess=function(d){var e=d.target.result;e&&($dhx.MQ.publish(b.dbs[c].root_topic+"."+a.table,{action:"select",target:"table",name:a.table,status:"success",message:"selected record",record_id:e.key}),a.onSuccess&&a.onSuccess(e.key,e.value,f,d))}},next:function(a){function b(b,e,f){$dhx.MQ.publish(c.dbs[d].root_topic+"."+a.table,{action:"select",target:"table",name:a.table,status:"success",message:"selected record",record_id:b.key}),a.onSuccess&&a.onSuccess(b.key,b.value,e,f)}try{var c=$dhx.dataDriver,d=a.db,e=(c.dbs[d].schema[a.table],c.getTableSchema(a)),f=(e.primary_key.keyPath,$dhx.dataDriver["public"][a.table]._internal_cursor_position),g=!1,h=!1,i="get next record. task: "+$dhx.crypt.SHA2(JSON.stringify(a));console.time(i);var j=c.db(d).transaction(a.table,"readonly"),k=j.objectStore(a.table);a.onSuccess=a.onSuccess||!1,a.onFail=a.onFail||!1,0==f&&(console.timeEnd(i),a.onFail&&a.onFail(null,null,"please select a record before calling next()"),$dhx._enable_log&&console.log("please select a record before calling next()")),j.addEventListener("complete",function(a){$dhx._enable_log&&console.warn("executed"),$dhx._enable_log&&console.log("transaction complete",a),console.timeEnd(i),$dhx._enable_log&&console.warn("tx next record is completed")}),j.addEventListener("onerror",function(b){console.timeEnd(i),a.onFail&&a.onFail(j,b,b.target.error.message),$dhx._enable_log&&console.log("error on transaction")}),j.addEventListener("abort",function(a){console.timeEnd(i),$dhx._enable_log&&console.warn("transaction aborted")});var l=k.openCursor();l.onsuccess=function(a){var c=a.target.result;c&&(f==c.key&&(g=!0),f!=c.key&&g&&!h&&(b(c,j,a),h=!0),c["continue"]())}}catch(m){console.log(m.stack)}},previous:function(a){function b(b,e,f){$dhx.MQ.publish(c.dbs[d].root_topic+"."+a.table,{action:"select",target:"table",name:a.table,status:"success",message:"selected record",record_id:b.key}),a.onSuccess&&a.onSuccess(b.key,b.value,e,f)}var c=$dhx.dataDriver,d=a.db,e=(c.dbs[d].schema[a.table],c.getTableSchema(a)),f=(e.primary_key.keyPath,$dhx.dataDriver["public"][a.table]._internal_cursor_position),g=!1,h=!1,i="get previous record. task: "+$dhx.crypt.SHA2(JSON.stringify(a));console.time(i);var j=c.db(d).transaction(a.table,"readonly"),k=j.objectStore(a.table);a.onSuccess=a.onSuccess||!1,a.onFail=a.onFail||!1,0==f&&(console.timeEnd(i),a.onFail&&a.onFail(null,null,"please select a record before calling previous()"),$dhx._enable_log&&console.log("please select a record before calling previous()")),j.addEventListener("complete",function(a){$dhx._enable_log&&console.warn("executed"),$dhx._enable_log&&console.log("transaction complete",a),console.timeEnd(i),$dhx._enable_log&&console.warn("tx previous record is completed")}),j.addEventListener("onerror",function(b){console.timeEnd(i),a.onFail&&a.onFail(j,b,b.target.error.message),$dhx._enable_log&&console.log("error on transaction")}),j.addEventListener("abort",function(a){console.timeEnd(i),$dhx._enable_log&&console.warn("transaction aborted")});var l=k.openCursor(null,"prev");l.onsuccess=function(a){var c=a.target.result;c&&(f==c.key&&(g=!0),f!=c.key&&g&&!h&&(b(c,j,a),h=!0),c["continue"]())}},idByIndex:function(){"use strict";$dhx.dataDriver},indexById:function(){"use strict";$dhx.dataDriver},item:function(){"use strict";$dhx.dataDriver},last:function(a){var b=$dhx.dataDriver,c=a.db,d=(b.dbs[c].schema[a.table],b.getTableSchema(a)),e=(d.primary_key.keyPath,{}),f="get last record. task: "+$dhx.crypt.SHA2(JSON.stringify(a));console.time(f);var g=b.db(c).transaction(a.table,"readonly"),h=g.objectStore(a.table);a.onSuccess=a.onSuccess||!1,a.onFail=a.onFail||!1,g.addEventListener("complete",function(a){$dhx._enable_log&&console.warn("executed"),$dhx._enable_log&&console.log("transaction complete",a),console.timeEnd(f),$dhx._enable_log&&console.warn("tx last record is completed")}),g.addEventListener("onerror",function(b){console.timeEnd(f),a.onFail&&a.onFail(g,b,b.target.error.message),$dhx._enable_log&&console.log("error on transaction")}),g.addEventListener("abort",function(b){console.timeEnd(f),a.onFail&&a.onFail(g,b,b.target.error.message),$dhx._enable_log&&console.warn("transaction aborted")});var i=h.openCursor();i.onsuccess=function(d){var f=d.target.result;f?(e.key=f.key,e.value=f.value,f["continue"]()):e.key&&($dhx.MQ.publish(b.dbs[c].root_topic+"."+a.table,{action:"select",target:"table",name:a.table,status:"success",message:"selected record",record_id:e.key}),a.onSuccess&&a.onSuccess(e.key,e.value,g,d))}},serialize:function(){"use strict";$dhx.dataDriver},sort:function(){"use strict";$dhx.dataDriver},connect:function(a){"use strict";var b=$dhx.dataDriver;try{$dhx.showDirections("Preparing database ... ");var c=b.indexedDB.open(a.db,a.version);return a.onConnect&&a.onConnect({connection:c,event:null,message:"connected"}),$dhx._enable_log&&console.warn("connected"),c}catch(d){$dhx._enable_log&&console.warn("sorry Eduardo, I cant connect! Error message: "+d.message),a.onConnectError&&a.onConnectError({connection:null,event:null,message:d.message})}},db:function(a){"use strict";var b=$dhx.dataDriver;try{return b.dbs[a].db}catch(c){return!1}},search:function(a){var b=$dhx.dataDriver,c=a.db,d=0,e={},f=[],g=(b.dbs[c].schema[a.table],b.getTableSchema(a));g.primary_key.keyPath;query=a.query,operator="and";var h="search records. task: "+$dhx.crypt.SHA2(JSON.stringify(a));console.time(h);var i=b.db(c).transaction(a.table,"readonly"),j=i.objectStore(a.table);i.addEventListener("complete",function(b){$dhx._enable_log&&console.warn("executed"),$dhx._enable_log&&console.log("transaction complete",b),console.timeEnd(h),a.onReady&&a.onReady(f,i,b),$dhx._enable_log&&console.warn("tx search is completed"),f=null}),i.addEventListener("onerror",function(b){console.timeEnd(h),a.onFail&&a.onFail(i,b,b.target.error.message),$dhx._enable_log&&console.log("error on transaction"),f=null}),i.addEventListener("abort",function(a){console.timeEnd(h),$dhx._enable_log&&console.warn("transaction aborted"),f=null}),query.and?e=query.and:query.or&&(operator="or",e=query.or);var k=j.openCursor();k.onsuccess=function(b){var c=b.target.result;if(c){var g=0,h=0;for(var j in e)""!=e[j]&&null!=e[j]&&(g+=1);for(var j in e)if(""!=e[j]&&null!=e[j]&&"undefined"!=typeof c.value[j])if(console.log(c.value),console.log(c.value[j]),$dhx.isNumber(c.value[j])&&$dhx.isNumber(e[j])){var k=new Number(e[j]),l=Number(c.value[j]);k==l&&(h+=1,h==g&&(d+=1,f.push(c.value),a.onFound&&a.onFound(c.key,c.value,i,b)))}else{var k=e[j].toLowerCase().latinize(),l=c.value[j].toLowerCase().latinize(),m=new RegExp(k);m.test(l)&&(h+=1,h==g&&(d+=1,f.push(c.value),a.onFound&&a.onFound(c.key,c.value,i,b)))}c["continue"]()}}},serialize:function(a){var b=$dhx.dataDriver,c=a.db,d=0,e=[],f=(b.dbs[c].schema[a.table],b.getTableSchema(a));f.primary_key.keyPath;query=a.query,operator="and";var g="serialize records. task: "+$dhx.crypt.SHA2(JSON.stringify(a));console.time(g);var h=b.db(c).transaction(a.table,"readonly"),i=h.objectStore(a.table);h.addEventListener("complete",function(b){$dhx._enable_log&&console.warn("executed"),$dhx._enable_log&&console.log("transaction complete",b),console.timeEnd(g),a.onSuccess&&a.onSuccess(e,h,b),$dhx._enable_log&&console.warn("tx serialize is completed")}),h.addEventListener("onerror",function(b){console.timeEnd(g),a.onFail&&a.onFail(h,b,b.target.error.message),$dhx._enable_log&&console.log("error on transaction")}),h.addEventListener("abort",function(a){console.timeEnd(g),$dhx._enable_log&&console.warn("transaction aborted")});var j=i.openCursor();j.onsuccess=function(a){var b=a.target.result;b&&(d+=1,e.push(b.value),b["continue"]())}},"public":[],events:[],_addInitialRecords:function(a,b,c){var d=$dhx.dataDriver,e=a.db;"database."+a.db;d._table_to_fill_on_init=Object.keys(d.dbs[e].records).length;for(var f in d.dbs[e].records)d.dbs[e].records.hasOwnProperty(f)&&$dhx.dataDriver["public"][f].add(d.dbs[e].records[f],function(c,e,f){d._table_to_filled_on_init=d._table_to_filled_on_init+1,d._table_to_filled_on_init==d._table_to_fill_on_init&&d._setReady(a,b,e)},function(a,b,c){},!0)},_setReady:function(a,b,c){var d=($dhx.dataDriver,a.db),e="database."+a.db;$dhx.hideDirections(),$dhx._enable_log&&console.warn("Database "+d+" is ready "),$dhx.MQ.publish(e,{action:"ready",target:"database",name:d,status:"success",message:"database is ready",onReady:a.onReady,onReadyO:{connection:b,event:c,message:"ready"}})},_createDatabase:function(a,b){var c=$dhx.dataDriver,d=a.db,e=a.schema||{},f=null,g=null,h=!1,i="database."+a.db;f=c.connect(a),f.onupgradeneeded=function(j){h=!0,$dhx._enable_log&&console.log(j),$dhx._enable_log&&console.warn("db "+d+" created "),g=f.result,g.onerror=function(a){$dhx._enable_log&&console.warn("   >>>>  DATABASE CONNECTION ERROR   <<<<  ",a)},g.onversionchange=function(a){$dhx._enable_log&&console.warn("   >>>>  DATABASE VERSION CHANGED   <<<<  ");
},g.onabort=function(a){$dhx._enable_log&&console.warn("   >>>>  DATABASE CONNECTION ABORTED   <<<<  ")},c.dbs[d]={db:g,name:d,schema:e,records:a.records,settings:a.settings,version:a.version,connection:f,event:j,subscriber:function(a,b){},root_topic:i},a.onCreate&&(c.dbs[d].onCreate=a.onCreate);for(var k in a.schema)a.schema.hasOwnProperty(k)&&b.table(k).create({primary_key:a.schema[k].primary_key,columns:a.schema[k].columns,records:a.schema[k].records,onSuccess:function(a){},onFail:function(a){}})},f.onerror=function(b){$dhx._enable_log&&console.warn("error when tryin to connect the "+d+" database",f.errorCode),a.onFail&&a.onFail({connection:f,event:b,message:"error when tryin to connect the "+d+" database"+f.errorCode})},f.onblocked=function(b){$dhx._enable_log&&console.warn("blocked"),a.onFail&&a.onFail({connection:f,event:b,message:"blocked"})},f.onsuccess=function(b){g=f.result,$dhx.jDBdStorage.storeObject("$dhx.db."+d,JSON.stringify({version:a.version,hash:$dhx.crypt.SHA2(JSON.stringify(e))})),c.dbs[d]={db:g,name:d,version:a.version,schema:e,records:a.records,settings:a.settings,connection:f,event:b,subscriber:function(a,b){$dhx._enable_log&&console.warn("DB received message: ",a,b),"ready"==b.action&&b.name==d&&"success"==b.status&&b.onReady&&b.onReady(b.onReadyO)},root_topic:i},$dhx.MQ.subscribe(i,c.dbs[d].subscriber),a.records&&h?c._addInitialRecords(a,f,b):c._setReady(a,f,b)},b.schema={};for(var j in a.schema)a.schema.hasOwnProperty(j)&&(b.schema[j]=function(d,e){return{attachEvent:function(a,b){"undefined"==typeof c.events[a]?c.events[a]=[]:"",c.events[a].push(b)},onAfterAdd:function(a,b){var d="onAfterAdd";"undefined"!=typeof c.events[d]&&c.events[d].forEach(function(c,d,e){c(a,b)})},onBeforeAdd:function(){var a="onBeforeAdd";"undefined"!=typeof c.events[a]&&c.events[a].forEach(function(a,b,c){a()})},onAfterCursorChange:function(a,b){var d="onAfterCursorChange";"undefined"!=typeof c.events[d]&&c.events[d].forEach(function(c,d,e){c(a,b)})},onBeforeCursorChange:function(){var a="onBeforeCursorChange";"undefined"!=typeof c.events[a]&&c.events[a].forEach(function(a,b,c){a()})},onAfterDelete:function(a){var b="onAfterDelete";"undefined"!=typeof c.events[b]&&c.events[b].forEach(function(b,c,d){b(a)})},onBeforeDelete:function(a){var b="onBeforeDelete";"undefined"!=typeof c.events[b]&&c.events[b].forEach(function(b,c,d){b(a)})},onAfterUpdate:function(a){var b="onAfterUpdate";"undefined"!=typeof c.events[b]&&c.events[b].forEach(function(b,c,d){b(a)})},onBeforeUpdate:function(a){var b="onBeforeUpdate";"undefined"!=typeof c.events[b]&&c.events[b].forEach(function(b,c,d){b(a)})},onBeforeLoading:function(a){var b="onBeforeLoading";"undefined"!=typeof c.events[b]&&c.events[b].forEach(function(b,c,d){b(a)})},onAfterLoading:function(a){var b="onAfterLoading";"undefined"!=typeof c.events[b]&&c.events[b].forEach(function(b,c,d){b(a)})},_synced_components:[],_bound_components:[],_internal_cursor_position:0,onAddRecord:!1,onUpdateRecord:!1,onDeleteRecord:!1,_subscriber:function(a,c){$dhx.isObject(c)||JSON.parse(c),"table"==c.target&&c.name==d&&($dhx._enable_log&&console.warn("table "+c.name+" from "+e+" database received message just right now: ",c),"select"==c.action&&"selected record"==c.message&&b.schema[d].setCursor(c.record_id,function(){},function(){}),"add"==c.action&&"record added"==c.message)},add:function(a,b,f,g){c.add({db:e,table:d,record:a,onSuccess:b,onFail:f,isOnCreate:g})},update:function(a,b,f,g,h){c.update({db:e,table:d,record_id:a,record:b,old_record:f,onSuccess:g,onFail:h})},load:function(a,b){c.load({db:e,table:d,onSuccess:a,onFail:b})},del:function(a,b,f){c.del({db:e,table:d,record_id:a,onSuccess:b,onFail:f})},remove:function(a,b,f){c.del({db:e,table:d,record_id:a,onSuccess:b,onFail:f})},clearAll:function(a,b){c.clearAll({db:e,table:d,onSuccess:a,onFail:b})},count:function(a,b){c.count({db:e,table:d,onSuccess:a,onFail:b})},getTableSizeInBytes:function(a,b){c.getTableSizeInBytes({db:e,table:d,onSuccess:a,onFail:b})},dataCount:function(a,b){c.count({db:e,table:d,onSuccess:a,onFail:b})},count:function(a,b){c.count({db:e,table:d,onSuccess:a,onFail:b})},bind:function(a,b){return{form:function(d){c.bind({db:a,table:b,component:d.component,prepare:d.prepare,type:"form",component_id:d.component_id,onSuccess:d.onSuccess,onFail:d.onFail})}}}(e,d),getCursor:function(a,b){c.getCursor({db:e,table:d,onSuccess:a,onFail:b})},getCurrentRecord:function(a,b){c.getCurrentRecord({db:e,table:d,onSuccess:a,onFail:b})},getRecord:function(a,b,f){c.getRecord({db:e,table:d,record_id:a,onSuccess:b,onFail:f})},filter:function(a,b){return{where:function(d){c.search({db:a,query:d.query,table:b,onReady:d.onReady,onFound:d.onFound,onFail:d.onFail})}}}(e,d),first:function(a,b){c.first({db:e,table:d,onSuccess:a,onFail:b})},exists:function(){},idByIndex:function(){},indexById:function(){},item:function(a,b){c.getCurrentRecord({db:e,table:d,onSuccess:a,onFail:b})},last:function(a,b){c.last({db:e,table:d,onSuccess:a,onFail:b})},next:function(a,b){c.next({db:e,table:d,onSuccess:a,onFail:b})},previous:function(a,b){c.previous({db:e,table:d,onSuccess:a,onFail:b})},_getColumnsId:function(a,b){return c._getColumnsId({db:e,table:d})},_getColumnsHeader:function(a,b){return c._getColumnsHeader({db:e,table:d})},_getColumnsType:function(a,b){return c._getColumnsType({db:e,table:d})},_getColumnsSorting:function(a,b){return c._getColumnsSorting({db:e,table:d})},_getColumnsAlign:function(a,b){return c._getColumnsAlign({db:e,table:d})},_getColumnsWidth:function(a,b){return c._getColumnsWidth({db:e,table:d})},serialize:function(){},sort:function(){},search:function(a,b){return{where:function(d){c.search({db:a,query:d.query,table:b,onReady:d.onReady,onFound:d.onFound,onFail:d.onFail})}}}(e,d),setCursor:function(a,b,f){c.setCursor({db:e,record_id:a,table:d,onSuccess:b,onFail:f})},sync:function(b,d){return{grid:function(a){c.sync({db:b,table:d,component:a.component,type:"grid",auto_configure:a.auto_configure,component_id:a.component_id,onSuccess:a.onSuccess,onFail:a.onFail})},combo:function(a){c.sync({db:b,table:d,component:a.component,type:"combo",$init:a.$init,component_id:a.component_id,onSuccess:a.onSuccess,onFail:a.onFail})},select:function(a){c.sync({db:b,table:d,component:a.component,type:"select",$init:a.$init,component_id:a.component_id,onSuccess:a.onSuccess,onFail:a.onFail})},selectGrid:function(a){c.sync({db:b,table:d,component:a.component,type:"selectGrid",$init:a.$init,component_id:a.component_id,onSuccess:a.onSuccess,onFail:a.onFail})},dataview:function(a){c.sync({db:b,table:d,component:a.component,type:"dataview",component_id:a.component_id,onSuccess:a.onSuccess,onFail:a.onFail})},scheduler:function(a){c.sync({db:b,table:d,component:a.component,type:"scheduler",component_id:a.component_id,onSuccess:a.onSuccess,onFail:a.onFail})},chart:function(){c.sync({db:b,table:d,component:a.component,type:"chart",component_id:a.component_id,onSuccess:a.onSuccess,onFail:a.onFail})}}}(e,d),unbind:function(a,b){return{form:function(d){c.unbind({db:a,table:b,component:d.component,type:"form",component_id:d.component_id,onSuccess:d.onSuccess,onFail:d.onFail})}}}(e,d),unsync:function(a,b){return{combo:function(d){c.unsync({db:a,table:b,component:d.component,type:"combo",component_id:d.component_id,onSuccess:d.onSuccess,onFail:d.onFail})},select:function(d){c.unsync({db:a,table:b,component:d.component,type:"select",component_id:d.component_id,onSuccess:d.onSuccess,onFail:d.onFail})},selectGrid:function(d){c.unsync({db:a,table:b,component:d.component,type:"selectGrid",component_id:d.component_id,onSuccess:d.onSuccess,onFail:d.onFail})},grid:function(d){c.unsync({db:a,table:b,component:d.component,type:"grid",component_id:d.component_id,onSuccess:d.onSuccess,onFail:d.onFail})}}}(e,d),toPDF:function(){var a=new jsPDF,b={"#bypassme":function(a,b){return!0}};a.fromHTML($(".row20px").parent().parent().html(),.5,.5,{width:7.5,elementHandlers:b}),a.save("Test.pdf")}}}(j,d,c)),$dhx.MQ.subscribe(i,b.schema[j]._subscriber),c["public"][j]=b.schema[j];b.table=function(a){return{create:function(b){b=b||{},c.createTable({db:d,table:a,columns:b.columns,primary_key:b.primary_key,records:b.records,onSuccess:b.onSuccess,onFail:b.onFail})}}},b.drop=function(b,e){"use strict";a=a||{},c.dropDatabase({db:d,onSuccess:b,onFail:e})},b._getQuota=function(a,b){if("Chrome"!=$dhx.Browser.name){var c=$dhx.Browser.name+" does not provide quota management.";return $dhx.notify("Quota information",c,"icons/db.png"),void(b&&b(c))}var d=window.webkitStorageInfo||navigator.webkitTemporaryStorage||navigator.webkitPersistentStorage;d.queryUsageAndQuota(d.TEMPORARY,function(b,c){console.log("Used quota: "+b+", remaining quota: "+c),a&&a(b,c)},function(a){b&&b(a),console.log("Error",a)})}},database:function(a){try{var b=$dhx.dataDriver,c=a.db,d=a.schema||{},e=this;"database."+a.db;if($dhx.MQ.oldPublish=$dhx.MQ.publish,$dhx.MQ.publish=function(a,b){return"record added"==b.message&&"undefined"!=typeof b.onInit&&b.onInit?void($dhx._enable_log&&console.warn("records added on init","I will not send cross window message")):(("record added"==b.message||"record updated"==b.message||"record deleted"==b.message)&&$dhx.jDBdStorage.storeObject("message."+a,JSON.stringify(b)),void $dhx.MQ.oldPublish(a,b))},window.addEventListener("storage",function(a){if(a.key&&-1!=a.key.indexOf("message.")){var b=a.key.replace("message.","");if(a.newValue){var c=JSON.parse(a.newValue);console.log(c),$dhx.MQ.oldPublish(b,JSON.parse(c)),$dhx.jDBdStorage.deleteDatabase("message."+b)}}},!1),b.protectIndexedDB(),!$dhx.dataDriver.browserPassed())return;if(!$dhx.dataDriver.validDSN(a))return;$dhx.isNumber(a.version)?a.version<1?a.version=1:"":a.version=1;var f=$dhx.jDBdStorage.get("$dhx.db."+c);"undefined"==typeof f?($dhx._enable_log&&console.warn("there is no version for database "+c+" at indexedDB."),$dhx._enable_log&&console.warn("Lets create it ...."),b._createDatabase(a,e)):(f=JSON.parse(f),"undefined"==typeof f.version?($dhx._enable_log&&console.warn("there is no version for database "+c+" at indexedDB."),$dhx._enable_log&&console.warn("Lets create it ...."),b._createDatabase(a,e)):($dhx._enable_log&&console.warn("there is as saved version for database "+c+" at indexedDB."),$dhx._enable_log&&console.log(f.hash,$dhx.crypt.SHA2(JSON.stringify(d))),f.hash==$dhx.crypt.SHA2(JSON.stringify(d))?($dhx._enable_log&&console.warn("old and new databases are equal. Lets open it!"),b._createDatabase(a,e)):($dhx._enable_log&&console.warn("currently database is out to date. lets update it."),b.dropDatabase({db:c,onSuccess:function(){b._createDatabase(a,e)},onFail:function(){}}))))}catch(g){console.log(g.stack)}},protectIndexedDB:function(){"use strict";"undefined"==typeof $dhx.dataDriver.indexedDB&&Object.defineProperty($dhx.dataDriver,"indexedDB",{value:window.indexedDB,enumerable:!0,configurable:!1,writable:!1})},getTableSchema:function(a){"use strict";$dhx.dataDriver;try{return $dhx.dataDriver.dbs[a.db].schema[a.table]}catch(b){return null}},_getColumnsByOrdinalPosition:function(a,b){"use strict";for(var c=0;c<a.length;c++){var d=a[c];if(d.ordinal_position==b)return d}return $dhx._enable_log&&console.warn("sorry Eduardo, I cant _getColumnsByOrdinalPosition! Error message: ordinal position not found"),{}},_getColumnsId:function(a){"use strict";var b=$dhx.dataDriver,c=b.getTableSchema(a),d=c.primary_key.keyPath,e=[],f=[d];for(var g in c.columns)c.columns.hasOwnProperty(g)&&e.push(c.columns[g]);e.sort(function(a,b){return a.ordinal_position-b.ordinal_position});for(var h=0;h<e.length;h++){var i=e[h];f.push(i.name)}return f.join(",")},_getColumnsHeader:function(a){"use strict";var b=$dhx.dataDriver,c=b.getTableSchema(a),d=c.primary_key.keyPath,e=[],f=[d];for(var g in c.columns)c.columns.hasOwnProperty(g)&&e.push(c.columns[g]);e.sort(function(a,b){return a.ordinal_position-b.ordinal_position});for(var h=0;h<e.length;h++){var i=e[h];f.push(i.dhtmlx_grid_header)}return f.join(",")},_getColumnsWidth:function(a){"use strict";var b=$dhx.dataDriver,c=b.getTableSchema(a),d=(c.primary_key.keyPath,[]),e=["*"];for(var f in c.columns)c.columns.hasOwnProperty(f)&&d.push(c.columns[f]);d.sort(function(a,b){return a.ordinal_position-b.ordinal_position});for(var g=0;g<d.length;g++){var h=d[g];e.push(h.dhtmlx_grid_width)}return e.join(",")},_getColumnsAlign:function(a){"use strict";var b=$dhx.dataDriver,c=b.getTableSchema(a),d=(c.primary_key.keyPath,[]),e=["right"];for(var f in c.columns)c.columns.hasOwnProperty(f)&&d.push(c.columns[f]);d.sort(function(a,b){return a.ordinal_position-b.ordinal_position});for(var g=0;g<d.length;g++){var h=d[g];e.push(h.dhtmlx_grid_align)}return e.join(",")},_getColumnsType:function(a){"use strict";var b=$dhx.dataDriver,c=b.getTableSchema(a),d=(c.primary_key.keyPath,[]),e=["ro"];for(var f in c.columns)c.columns.hasOwnProperty(f)&&d.push(c.columns[f]);d.sort(function(a,b){return a.ordinal_position-b.ordinal_position});for(var g=0;g<d.length;g++){d[g];e.push(d[g].dhtmlx_grid_type)}return e.join(",")},_getColumnsSorting:function(a){"use strict";var b=$dhx.dataDriver,c=b.getTableSchema(a),d=(c.primary_key.keyPath,[]),e=["int"];for(var f in c.columns)c.columns.hasOwnProperty(f)&&d.push(c.columns[f]);d.sort(function(a,b){return a.ordinal_position-b.ordinal_position});for(var g=0;g<d.length;g++){d[g];e.push(d[g].dhtmlx_grid_sorting)}return e.join(",")},_setInputMask:function(a,b){if("currency"==b){try{id=a.id}catch(c){id=a.getAttribute("id")}$("#"+id).priceFormat({prefix:""})}else if("can_currency"==b){try{id=a.id}catch(c){id=a.getAttribute("id")}$("#"+id).priceFormat({prefix:"CAN "})}else"integer"==b?a.onkeydown=function(a){only_integer(this)}:"us_phone"==b?(a.onkeypress=function(a){phone_mask(this)},a.maxLength="13"):"expiration_date"==b?(a.onkeypress=function(a){expiration_date(this)},a.maxLength="5"):"cvv"==b?(a.onkeydown=function(a){only_integer(this)},a.maxLength="4"):"credit_card"==b?(a.onkeydown=function(a){only_integer(this)},a.maxLength="16"):"time"==b?(a.onkeydown=function(a){time_mask(this,a)},a.maxLength="8"):"SSN"==b&&(a.onkeypress=function(a){ssn_mask(this)},a.maxLength="11")},_validateValueByType:function(a,b,c){var d=b.toString().match("NotEmpty"),e=b.toString().match("Empty"),f=b.toString().match("ValidEmail"),g=b.toString().match("ValidInteger"),h=b.toString().match("ValidFloat"),i=b.toString().match("ValidNumeric"),j=b.toString().match("ValidAplhaNumeric"),k=b.toString().match("ValidDatetime"),l=b.toString().match("ValidDate"),m=b.toString().match("ValidTime"),n=b.toString().match("ValidCurrency"),o=b.toString().match("ValidSSN"),p=b.toString().match("ValidExpirationdate");if("NotEmpty"==d&&a.toString().length<1)return dhtmlx.message({type:"error",text:$dhx.dhtmlx.text_labels.validation_notEmpty(c)}),!1;if("Empty"==e&&"NotEmpty"!=d&&a.toString().length>0)return dhtmlx.message({type:"error",text:$dhx.dhtmlx.text_labels.validation_Empty(c)}),!1;if("ValidEmail"==f&&a.length>0&&!/^([a-zA-Z0-9_\-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/.test(a))return dhtmlx.message({type:"error",text:$dhx.dhtmlx.text_labels.validation_ValidEmail(c)}),!1;if("ValidInteger"==g&&a.length>0&&!a.match(/^\d+$/))return dhtmlx.message({type:"error",text:$dhx.dhtmlx.text_labels.validation_ValidInteger(c)}),!1;if("ValidFloat"==h&&a.length>0&&!a.match(/^\d+\.\d+$/))return dhtmlx.message({type:"error",text:$dhx.dhtmlx.text_labels.validation_ValidFloat(c)}),!1;if("ValidNumeric"==i&&a.length>0&&isNaN(a))return dhtmlx.message({type:"error",text:$dhx.dhtmlx.text_labels.validation_ValidNumeric(c)}),!1;if("ValidAplhaNumeric"==j&&a.length>0&&!a.match(/^[0-9a-z]+$/))return dhtmlx.message({type:"error",text:$dhx.dhtmlx.text_labels.validation_ValidAplhaNumeric(c)}),!1;if("ValidDatetime"==k&&a.length>0&&isNaN(Date.parse(a)))return dhtmlx.message({type:"error",text:$dhx.dhtmlx.text_labels.validation_ValidDatetime(c)}),!1;if("ValidDate"==l&&a.length>0&&isNaN(Date.parse(a)))return dhtmlx.message({type:"error",text:$dhx.dhtmlx.text_labels.validation_ValidDate(c)}),!1;if("ValidTime"==m&&a.length>0){var q=a.match(/^(\d{1,2}):(\d{2})(:(\d{2}))?(\s?(AM|am|PM|pm))?$/);if(null==q)return dhtmlx.message({type:"error",text:$dhx.dhtmlx.text_labels.validation_ValidTime(c)}),!1;if("am"==a.toString().toLowerCase().match("am")||"pm"==a.toString().toLowerCase().match("pm")){if(a.split(":")[0]>12||a.split(":")[1].split(" ")[0]>59)return dhtmlx.message({type:"error",text:$dhx.dhtmlx.text_labels.validation_ValidTime(c)}),!1}else if(a.split(":")[0]>23||a.split(":")[1]>59)return dhtmlx.message({type:"error",text:$dhx.dhtmlx.text_labels.validation_ValidTime(c)}),!1}if("ValidCurrency"==n&&a.length>0&&!/^\d+(?:\.\d{0,2})$/.test(a))return dhtmlx.message({type:"error",text:$dhx.dhtmlx.text_labels.validation_ValidCurrency(c)}),!1;if("ValidSSN"==o&&a.length>0&&!a.match(/^\d{3}-\d{2}-\d{4}$/))return dhtmlx.message({type:"error",text:$dhx.dhtmlx.text_labels.validation_ValidSSN(c)}),!1;if("ValidExpirationdate"==p&&a.length>0){if(5!=a.length)return dhtmlx.message({type:"error",text:$dhx.dhtmlx.text_labels.validation_ValidExpirationdate(c)}),!1;var r=a.split("/")[0],s=a.split("/")[1];if(isNaN(r)||isNaN(s))return dhtmlx.message({type:"error",text:$dhx.dhtmlx.text_labels.validation_ValidExpirationdate(c)}),!1;if(!(r>0&&13>r))return dhtmlx.message({type:"error",text:$dhx.dhtmlx.text_labels.validation_ValidExpirationdate(c)}),!1;if(!(s>0&&99>s))return dhtmlx.message({type:"error",text:$dhx.dhtmlx.text_labels.validation_ValidExpirationdate(c)}),!1}return!0},disconnect:function(a){"use strict";try{var b=$dhx.dataDriver;b.db(a)&&b.db(a).close()}catch(d){$dhx._enable_log&&console.warn("sorry Eduardo, I cant disconnect! Error message: "+d.message),c.onFail&&c.onFail(null,null,d.message)}},_setInputInvalid:function(a){a.style.backgroundColor="#fdafa3",a.focus(),a.onclick=function(){a.style.backgroundColor="#fff"},a.onchange=function(){a.style.backgroundColor="#fff"},a.onkeydown=function(){a.style.backgroundColor="#fff"}},_setInputHighlighted:function(a,b){var c=$dhx.dataDriver,d=a.name,e=a.type;if("combo"==e){var f=b.getCombo(d);f.openSelect()}else"editor"==e||("multiselect"==e?c._setInputInvalid(b.getSelect(d)):"select"==e?c._setInputInvalid(b.getSelect(d)):c._setInputInvalid(b.getInput(d)))}};