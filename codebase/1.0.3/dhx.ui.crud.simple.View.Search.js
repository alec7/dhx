/*! dhx 2015-06-01 */
$dhx.ui.crud.simple.View.Search={window:[],strWindowID:"dbDemo.view.Search.window",layout:[],form:[],_window:function(a){var b=$dhx.ui.crud.simple.View.Search;b.window[a]=new $dhx.ui.window({id:b.strWindowID+a,left:$dhx.ui.crud.simple.View.settings.FormWindow.window.left,top:$dhx.ui.crud.simple.View.settings.FormWindow.window.top,width:$dhx.ui.crud.simple.View.settings.FormWindow.window.width,height:$dhx.ui.crud.simple.View.settings.FormWindow.window.height}),b.window[a].button("park").hide(),b.window[a].button("minmax").hide(),b.window[a].button("stick").hide(),b.window[a].attachEvent("onClose",function(c){return b.form[a].unload(),b.form[a]=null,!0}),b.window[a].setText(a.CFC()+" - "+$dhx.ui.language.Provide_some_values_to_search),b.status_bar=b.window[a].attachStatusBar(),b.status_bar.setText($dhx.ui.language.insensitivity_search)},_layout:function(a){var b=$dhx.ui.crud.simple.View.Search;b.layout[a]=b.window[a].attachLayout($dhx.ui.crud.simple.View.settings.FormWindow.layout),b.layout[a].cells("a").hideHeader()},_form:function(a,b,c,d){var e=$dhx.ui.crud.simple.View.Search,f=$dhx.ui.crud.controller[d],g=e.strWindowID=".form."+a;$dhx.ui.crud.simple.View.settings.Search.form.template[1].list=b.form.template,e.form[a]=e.layout[a].cells("a").attachForm($dhx.ui.crud.simple.View.settings.Search.form.template),$dhx.dhtmlx.prepareForm(g,$dhx.ui.crud.simple.View.settings.Search.form,e.form[a]),$dhx.dhtmlx.formFields[g].forEach(function(f,h,i){if("combo"==f.type){if("undefined"!=typeof f.dhx_table&&"undefined"!=typeof f.dhx_prop_text&&"undefined"!=typeof f.dhx_prop_value){var j=e.form[a].getCombo(f.name);$dhx.dataDriver["public"][f.dhx_table].sync.combo({component:j,component_id:g+"_combo_"+f.name,$init:function(a){a.value=a[f.dhx_prop_value],a.text=a[f.dhx_prop_text]},onSuccess:function(){},onFail:function(){}})}}else if("select"==f.type){if("undefined"!=typeof f.dhx_table&&"undefined"!=typeof f.dhx_prop_text&&"undefined"!=typeof f.dhx_prop_value){var k=e.form[a].getSelect(f.name);$dhx.dataDriver["public"][f.dhx_table].sync.select({component:k,component_id:g+"_select_"+f.name,$init:function(a){a.value=a[f.dhx_prop_value],a.text=a[f.dhx_prop_text]},onSuccess:function(){},onFail:function(){}})}}else e.form[a].getInput(f.name).addEventListener("keyup",function(f){this.value.length%2&&window.setTimeout(function(){e.doSearch(a,b,c,d)},500)})});var h={};e.form[a].forEachItem(function(a){h[a]=""}),e.form[a].setFormData(h),e.form[a].attachEvent("onButtonClick",function(g){"search"==g?e.doSearch(a,b,c,d):"clear_results"==g&&(f.view.grid.clearAll(),c.load(function(a,b,c,e){f.view.helpers.disableButtonActions(d);var g={rows:[]},h={db:$dhx.ui.crud.controller[d].database,table:$dhx.ui.crud.controller[d].collection},i=$dhx.dataDriver.getTableSchema(h),j=i.primary_key.keyPath,k=$dhx.dataDriver._getColumnsId(h).split(",");a.forEach(function(a,b,c){var d=[];k.forEach(function(b,c,e){d[c]=a.record[b]}),g.rows.push({id:a.record[j],data:d})}),f.view.grid.parse(g,"json")},function(a,b,c){console.log(c)}))})},doSearch:function(a,b,c,d){var e=$dhx.ui.crud.simple.View.Search,f=$dhx.ui.crud.controller[d];f.view.grid.clearAll(),c.search.where({query:{and:e.form[a].getFormData()},onFound:function(b,c,f,g){var h={db:$dhx.ui.crud.controller[d].database,table:$dhx.ui.crud.controller[d].collection},i=$dhx.dataDriver.getTableSchema(h),j=(i.primary_key.keyPath,$dhx.dataDriver._getColumnsId(h).split(",")),k=[];j.forEach(function(a,b,d){k[b]=c[a]}),e.form[a].setFocusOnFirstActive()},onReady:function(b,c,g){var h={rows:[]},i={db:$dhx.ui.crud.controller[d].database,table:$dhx.ui.crud.controller[d].collection},j=$dhx.dataDriver.getTableSchema(i),k=j.primary_key.keyPath,l=$dhx.dataDriver._getColumnsId(i).split(",");b.forEach(function(a,b,c){var d=[];l.forEach(function(b,c,e){d[c]=a[b]}),h.rows.push({id:a[k],data:d})}),f.view.grid.parse(h,"json"),e.form[a].setFocusOnFirstActive()},onerror:function(){e.form[a].setFocusOnFirstActive()}})},table:[],controller:[],render:function(a){var b=$dhx.ui.crud.simple.View.Search,c=(a.database,a.table,a.schema),d=a.appId;b.controller[e]=$dhx.ui.crud.controller[d];var e=a.table;if(b.table[e]=a.table,$dhx.ui.window_manager.isWindow(b.strWindowID+e))return b.window[e].show(),void b.window[e].bringToTop();$dhx.showDirections("starting view ... ");var f=$dhx.ui.data.model.settings[a.database][a.table];b._window(e),b._layout(e),b._form(e,f,c,d),b.form[e].setFocusOnFirstActive(),a.fnCallBack&&a.fnCallBack(),$dhx.hideDirections()}};